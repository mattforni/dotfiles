"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("atom"),t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i="object"==typeof t&&t&&t.Object===Object&&t,s="object"==typeof self&&self&&self.Object===Object&&self,r=i||s||Function("return this")(),n=r.Symbol,o=n,a=Object.prototype,d=a.hasOwnProperty,l=a.toString,c=o?o.toStringTag:void 0;var h=function(e){var t=d.call(e,c),i=e[c];try{e[c]=void 0;var s=!0}catch(e){}var r=l.call(e);return s&&(t?e[c]=i:delete e[c]),r},u=Object.prototype.toString;var g=h,p=function(e){return u.call(e)},f=n?n.toStringTag:void 0;var m=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":f&&f in Object(e)?g(e):p(e)};var b=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},v=m,y=b;var w,_=function(e){if(!y(e))return!1;var t=v(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},I=r["__core-js_shared__"],L=(w=/[^.]+$/.exec(I&&I.keys&&I.keys.IE_PROTO||""))?"Symbol(src)_1."+w:"";var E=function(e){return!!L&&L in e},$=Function.prototype.toString;var D=_,P=E,M=b,C=function(e){if(null!=e){try{return $.call(e)}catch(e){}try{return e+""}catch(e){}}return""},j=/^\[object .+?Constructor\]$/,O=Function.prototype,A=Object.prototype,S=O.toString,U=A.hasOwnProperty,N=RegExp("^"+S.call(U).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var T=function(e){return!(!M(e)||P(e))&&(D(e)?N:j).test(C(e))},k=function(e,t){return null==e?void 0:e[t]};var x=function(e,t){var i=k(e,t);return T(i)?i:void 0},R=x(Object,"create"),F=R;var B=function(){this.__data__=F?F(null):{},this.size=0};var z=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},q=R,V=Object.prototype.hasOwnProperty;var G=function(e){var t=this.__data__;if(q){var i=t[e];return"__lodash_hash_undefined__"===i?void 0:i}return V.call(t,e)?t[e]:void 0},K=R,W=Object.prototype.hasOwnProperty;var Y=R;var X=B,H=z,J=G,Q=function(e){var t=this.__data__;return K?void 0!==t[e]:W.call(t,e)},Z=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Y&&void 0===t?"__lodash_hash_undefined__":t,this};function ee(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var s=e[t];this.set(s[0],s[1])}}ee.prototype.clear=X,ee.prototype.delete=H,ee.prototype.get=J,ee.prototype.has=Q,ee.prototype.set=Z;var te=ee;var ie=function(){this.__data__=[],this.size=0};var se=function(e,t){return e===t||e!=e&&t!=t};var re=function(e,t){for(var i=e.length;i--;)if(se(e[i][0],t))return i;return-1},ne=re,oe=Array.prototype.splice;var ae=re;var de=re;var le=re;var ce=ie,he=function(e){var t=this.__data__,i=ne(t,e);return!(i<0)&&(i==t.length-1?t.pop():oe.call(t,i,1),--this.size,!0)},ue=function(e){var t=this.__data__,i=ae(t,e);return i<0?void 0:t[i][1]},ge=function(e){return de(this.__data__,e)>-1},pe=function(e,t){var i=this.__data__,s=le(i,e);return s<0?(++this.size,i.push([e,t])):i[s][1]=t,this};function fe(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var s=e[t];this.set(s[0],s[1])}}fe.prototype.clear=ce,fe.prototype.delete=he,fe.prototype.get=ue,fe.prototype.has=ge,fe.prototype.set=pe;var me=fe,be=x(r,"Map"),ve=te,ye=me,we=be;var _e=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var Ie=function(e,t){var i=e.__data__;return _e(t)?i["string"==typeof t?"string":"hash"]:i.map},Le=Ie;var Ee=Ie;var $e=Ie;var De=Ie;var Pe=function(){this.size=0,this.__data__={hash:new ve,map:new(we||ye),string:new ve}},Me=function(e){var t=Le(this,e).delete(e);return this.size-=t?1:0,t},Ce=function(e){return Ee(this,e).get(e)},je=function(e){return $e(this,e).has(e)},Oe=function(e,t){var i=De(this,e),s=i.size;return i.set(e,t),this.size+=i.size==s?0:1,this};function Ae(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var s=e[t];this.set(s[0],s[1])}}Ae.prototype.clear=Pe,Ae.prototype.delete=Me,Ae.prototype.get=Ce,Ae.prototype.has=je,Ae.prototype.set=Oe;var Se=Ae,Ue=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Ne=function(e){return this.__data__.has(e)};function Te(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new Se;++t<i;)this.add(e[t])}Te.prototype.add=Te.prototype.push=Ue,Te.prototype.has=Ne;var ke=Te;var xe=function(e,t,i,s){for(var r=e.length,n=i+(s?1:-1);s?n--:++n<r;)if(t(e[n],n,e))return n;return-1},Re=function(e){return e!=e},Fe=function(e,t,i){for(var s=i-1,r=e.length;++s<r;)if(e[s]===t)return s;return-1};var Be=function(e,t,i){return t==t?Fe(e,t,i):xe(e,Re,i)};var ze=function(e,t){return!!(null==e?0:e.length)&&Be(e,t,0)>-1};var qe=function(e,t,i){for(var s=-1,r=null==e?0:e.length;++s<r;)if(i(t,e[s]))return!0;return!1};var Ve=function(e,t){return e.has(t)};var Ge=function(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=e})),i},Ke=x(r,"Set"),We=function(){},Ye=Ke&&1/Ge(new Ke([,-0]))[1]==1/0?function(e){return new Ke(e)}:We,Xe=ke,He=ze,Je=qe,Qe=Ve,Ze=Ye,et=Ge;var tt=function(e,t,i){var s=-1,r=He,n=e.length,o=!0,a=[],d=a;if(i)o=!1,r=Je;else if(n>=200){var l=t?null:Ze(e);if(l)return et(l);o=!1,r=Qe,d=new Xe}else d=t?[]:a;e:for(;++s<n;){var c=e[s],h=t?t(c):c;if(c=i||0!==c?c:0,o&&h==h){for(var u=d.length;u--;)if(d[u]===h)continue e;t&&d.push(h),a.push(c)}else r(d,h,i)||(d!==a&&d.push(h),a.push(c))}return a};var it=function(e){return e&&e.length?tt(e):[]};function st(e,t,i){const s=i.map((e=>`  â€¢ ${e}`));atom.notifications.addWarning(`[Linter] ${e}`,{dismissable:!0,detail:`${t}\n${s.join("\n")}`})}const rt=new Set(["error","warning","info"]);function nt(t,i){const s=[];if(Array.isArray(i)){let t=!1,r=!1,n=!1,o=!1,a=!1,d=!1,l=!1,c=!1,h=!1;for(let u=0,{length:g}=i;u<g;++u){const g=i[u],{reference:p}=g;if(!r&&g.icon&&"string"!=typeof g.icon&&(r=!0,s.push("Message.icon must be a string")),o||g.location&&"object"==typeof g.location&&"string"==typeof g.location.file&&"object"==typeof g.location.position&&g.location.position){if(!o){const t=e.Range.fromObject(g.location.position);(Number.isNaN(t.start.row)||Number.isNaN(t.start.column)||Number.isNaN(t.end.row)||Number.isNaN(t.end.column))&&(o=!0,s.push("Message.location.position should not contain NaN coordinates"))}}else o=!0,s.push("Message.location must be valid");if(d||!g.solutions||Array.isArray(g.solutions)||g.solutions instanceof Promise||(d=!0,s.push("Message.solutions must be valid")),l||!p||"object"==typeof p&&"string"==typeof p.file&&"object"==typeof p.position&&p.position){if(!l&&p&&void 0!==p.position){const t=e.Point.fromObject(p.position);(Number.isNaN(t.row)||Number.isNaN(t.column))&&(l=!0,s.push("Message.reference.position should not contain NaN coordinates"))}}else l=!0,s.push("Message.reference must be valid");n||"string"==typeof g.excerpt||(n=!0,s.push("Message.excerpt must be a string")),a||rt.has(g.severity)||(a=!0,s.push("Message.severity must be 'error', 'warning' or 'info'")),!t&&g.url&&"string"!=typeof g.url&&(t=!0,s.push("Message.url must be a string")),!c&&g.description&&"function"!=typeof g.description&&"string"!=typeof g.description&&(c=!0,s.push("Message.description must be a function or string")),!h&&g.linterName&&"string"!=typeof g.linterName&&(h=!0,s.push("Message.linterName must be a string"))}}else s.push("Linter Result must be an Array");return!s.length||(st("Invalid Linter Result received",`These issues were encountered while processing messages from a linter named '${t}'`,s),!1)}class ot{constructor(){this.providers=new Set,this.subscriptions=new e.CompositeDisposable}add(e){!this.providers.has(e)&&function(e){const t=[];return e&&"object"==typeof e?("string"!=typeof e.name&&t.push("UI.name must be a string"),"function"!=typeof e.didBeginLinting&&t.push("UI.didBeginLinting must be a function"),"function"!=typeof e.didFinishLinting&&t.push("UI.didFinishLinting must be a function"),"function"!=typeof e.render&&t.push("UI.render must be a function"),"function"!=typeof e.dispose&&t.push("UI.dispose must be a function")):t.push("UI must be an object"),!t.length||(st("Invalid UI received",`These issues were encountered while registering the UI named '${e&&e.name?e.name:"Unknown"}'`,t),!1)}(e)&&(this.subscriptions.add(e),this.providers.add(e))}delete(e){this.providers.has(e)&&(e.dispose(),this.providers.delete(e))}getProviders(){return Array.from(this.providers)}render(e){this.providers.forEach((function(t){t.render(e)}))}didBeginLinting(e,t){this.providers.forEach((function(i){i.didBeginLinting(e,t)}))}didFinishLinting(e,t){this.providers.forEach((function(i){i.didFinishLinting(e,t)}))}dispose(){this.providers.clear(),this.subscriptions.dispose()}}const at="__$sb_linter_activated",dt="__$sb_linter_request_last_received";function lt(e,t,i){return!(t&&!e.lintsOnChange)&&i.some((function(t){return e.grammarScopes.includes(t)}))}function ct(e){return it(e.getCursors().reduce(((e,t)=>e.concat(t.getScopeDescriptor().getScopesArray())),["*"]))}let ht;async function ut(t,i,s){if(!t)return!0;if(s){const i=new e.Directory(t),s=await atom.project.repositoryForDirectory(i);if(s&&s.isPathIgnored(t))return!0}const r="win32"===process.platform?t.replace(/\\/g,"/"):t;return ht||(ht=require("minimatch")),ht(r,i)}function gt(e){const{reference:t,location:i}=e;e.key=[`$LINTER:${e.linterName}`,`$LOCATION:${i.file}$${i.position.start.row}$${i.position.start.column}$${i.position.end.row}$${i.position.end.column}`,t?`$REFERENCE:${t.file}$${t.position?`${t.position.row}$${t.position.column}`:""}`:"$REFERENCE:null",`$EXCERPT:${e.excerpt}`,`$SEVERITY:${e.severity}`,e.icon?`$ICON:${e.icon}`:"$ICON:null",e.url?`$URL:${e.url}`:"$URL:null","string"==typeof e.description?`$DESCRIPTION:${e.description}`:"$DESCRIPTION:null"].join("")}function pt(e,t){for(let i=0,{length:s}=t;i<s;++i){const s=t[i],{reference:r,solutions:n}=s;if(s.location.position=mt(s.location.position),void 0!==r&&void 0!==r.position&&(r.position=ft(r.position)),Array.isArray(n))for(let e=0,t=n.length;e<t;e++){const t=n[e];t.position=mt(t.position)}s.version=2,s.linterName||(s.linterName=e),gt(s)}}function ft(t){return t instanceof e.Point?t:e.Point.fromObject(t)}function mt(t){return t instanceof e.Range?t:e.Range.fromObject(t)}function bt(e,t){if(void 0===e||void 0===t)return null;if(!t.length)return{oldKept:[],oldRemoved:[],newAdded:e};if(!e.length)return{oldKept:[],oldRemoved:t,newAdded:[]};const i=function(e){const t=new Map;for(let i=0,{length:s}=e;i<s;++i){const s=e[i];t.set(s.key,s)}return t}(t),s=new Set,r=new Map;for(let t=0,n=e.length;t<n;t++){const n=e[t];i.has(n.key)?r.set(n.key,n):s.add(n)}const n=Array.from(i.keys()),o=Array.from(r.keys()),a=n.filter((e=>!o.includes(e))),d=new Set;for(let e=0,t=a.length;e<t;e++)d.add(i.get(a[e]));return{oldKept:Array.from(r.values()),oldRemoved:[...d],newAdded:[...s]}}function vt(e,t){t.length&&Array.prototype.push.apply(e,t)}class yt{constructor(t,i){this.scope="project",this.emitter=new e.Emitter,this.messages=new Map,this.subscriptions=new e.CompositeDisposable,this.indie=t,this.version=i,this.subscriptions.add(this.emitter)}get name(){return this.indie.name}getMessages(){const e=[];return this.messages.forEach((t=>{vt(e,t)})),e}clearMessages(){this.subscriptions.disposed||(this.emitter.emit("did-update",[]),this.messages.clear())}setMessages(e,t=null){if("string"!=typeof e||!Array.isArray(t))throw new Error("Invalid Parameters to setMessages()");!this.subscriptions.disposed&&nt(this.name,t)&&(t.forEach((function(t){if(t.location.file!==e)throw console.debug("[Linter-UI-Default] Expected File",e,"Message",t),new Error("message.location.file does not match the given filePath")})),pt(this.name,t),this.messages.set(e,t),this.emitter.emit("did-update",this.getMessages()))}setAllMessages(e){if(!this.subscriptions.disposed&&(Array.isArray(e)&&!atom.inDevMode()||nt(this.name,e))){pt(this.name,e),this.messages.clear();for(let t=0,{length:i}=e;t<i;++t){const i=e[t],s=i.location.file;let r=this.messages.get(s);r||this.messages.set(s,r=[]),r.push(i)}this.emitter.emit("did-update",this.getMessages())}}onDidUpdate(e){return this.emitter.on("did-update",e)}onDidDestroy(e){return this.emitter.on("did-destroy",e)}dispose(){this.emitter.emit("did-destroy"),this.subscriptions.dispose(),this.messages.clear()}}class wt{constructor(){this.emitter=new e.Emitter,this.delegates=new Set,this.subscriptions=new e.CompositeDisposable,this.subscriptions.add(this.emitter)}register(e,t){if(!function(e){const t=[];return e&&"object"==typeof e?"string"!=typeof e.name&&t.push("Indie.name must be a string"):t.push("Indie must be an object"),!t.length||(st("Invalid Indie received",`These issues were encountered while registering an Indie Linter named '${e&&e.name?e.name:"Unknown"}'`,t),!1)}(e))throw new Error("Error registering Indie Linter");const i=new yt(e,t);return this.delegates.add(i),i.onDidDestroy((()=>{this.delegates.delete(i)})),i.onDidUpdate((e=>{this.emitter.emit("did-update",{linter:i,messages:e})})),this.emitter.emit("observe",i),i}getProviders(){return Array.from(this.delegates)}observe(e){return this.delegates.forEach(e),this.emitter.on("observe",e)}onDidUpdate(e){return this.emitter.on("did-update",e)}dispose(){for(const e of this.delegates)e.dispose();this.subscriptions.dispose()}}var _t=r,It=/\s/;var Lt=function(e){for(var t=e.length;t--&&It.test(e.charAt(t)););return t},Et=/^\s+/;var $t=m,Dt=function(e){return null!=e&&"object"==typeof e};var Pt=function(e){return e?e.slice(0,Lt(e)+1).replace(Et,""):e},Mt=b,Ct=function(e){return"symbol"==typeof e||Dt(e)&&"[object Symbol]"==$t(e)},jt=/^[-+]0x[0-9a-f]+$/i,Ot=/^0b[01]+$/i,At=/^0o[0-7]+$/i,St=parseInt;var Ut=b,Nt=function(){return _t.Date.now()},Tt=function(e){if("number"==typeof e)return e;if(Ct(e))return NaN;if(Mt(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Mt(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Pt(e);var i=Ot.test(e);return i||At.test(e)?St(e.slice(2),i?2:8):jt.test(e)?NaN:+e},kt=Math.max,xt=Math.min;var Rt=function(e,t,i){var s,r,n,o,a,d,l=0,c=!1,h=!1,u=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function g(t){var i=s,n=r;return s=r=void 0,l=t,o=e.apply(n,i)}function p(e){return l=e,a=setTimeout(m,t),c?g(e):o}function f(e){var i=e-d;return void 0===d||i>=t||i<0||h&&e-l>=n}function m(){var e=Nt();if(f(e))return b(e);a=setTimeout(m,function(e){var i=t-(e-d);return h?xt(i,n-(e-l)):i}(e))}function b(e){return a=void 0,u&&s?g(e):(s=r=void 0,o)}function v(){var e=Nt(),i=f(e);if(s=arguments,r=this,d=e,i){if(void 0===a)return p(d);if(h)return clearTimeout(a),a=setTimeout(m,t),g(d)}return void 0===a&&(a=setTimeout(m,t)),o}return t=Tt(t)||0,Ut(i)&&(c=!!i.leading,n=(h="maxWait"in i)?kt(Tt(i.maxWait)||0,t):n,u="trailing"in i?!!i.trailing:u),v.cancel=function(){void 0!==a&&clearTimeout(a),l=0,s=d=r=a=void 0},v.flush=function(){return void 0===a?o:b(Nt())},v};class Ft{constructor(){this.emitter=new e.Emitter,this.messages=[],this.messagesMap=new Set,this.subscriptions=new e.CompositeDisposable,this.debouncedUpdate=Rt(this.update,100,{leading:!0}),this.subscriptions.add(this.emitter)}set({messages:e,linter:t,buffer:i}){let s=null;for(const e of this.messagesMap)if(e.buffer===i&&e.linter===t){s=e;break}s?(s.messages=e,s.changed=!0):this.messagesMap.add({messages:e,linter:t,buffer:i,oldMessages:[],changed:!0,deleted:!1}),this.debouncedUpdate()}update(){const e={added:[],removed:[],messages:[]};for(const t of this.messagesMap){if(t.deleted){vt(e.removed,t.oldMessages),this.messagesMap.delete(t);continue}if(!t.changed){vt(e.messages,t.oldMessages);continue}const i=bt(t.messages,t.oldMessages);if(null!==i){const{oldKept:s,oldRemoved:r,newAdded:n}=i;vt(e.added,n),vt(e.removed,r);const o=n.concat(s);vt(e.messages,o),t.oldMessages=o}}(e.added.length||e.removed.length)&&(this.messages=e.messages,this.emitter.emit("did-update-messages",e))}onDidUpdateMessages(e){return this.emitter.on("did-update-messages",e)}deleteByBuffer(e){for(const t of this.messagesMap)t.buffer===e&&(t.deleted=!0);this.debouncedUpdate()}deleteByLinter(e){for(const t of this.messagesMap)t.linter===e&&(t.deleted=!0);this.debouncedUpdate()}dispose(){this.subscriptions.dispose()}}class Bt{constructor(){this.emitter=new e.Emitter,this.linters=new Set,this.lintOnChange=!0,this.ignoreVCS=!0,this.ignoreGlob="**/*.min.{js,css}",this.lintPreviewTabs=!0,this.subscriptions=new e.CompositeDisposable,this.disabledProviders=[],this.activeNotifications=new Set,this.subscriptions.add(this.emitter,atom.config.observe("linter.lintOnChange",(e=>{this.lintOnChange=e})),atom.config.observe("core.excludeVcsIgnoredPaths",(e=>{this.ignoreVCS=e})),atom.config.observe("linter.ignoreGlob",(e=>{this.ignoreGlob=e})),atom.config.observe("linter.lintPreviewTabs",(e=>{this.lintPreviewTabs=e})),atom.config.observe("linter.disabledProviders",(e=>{0!==e.length&&console.warn(`Linter package: disabled linter providers: ${e}`),this.disabledProviders=e})))}hasLinter(e){return this.linters.has(e)}addLinter(e){(function(e){const t=[];return e&&"object"==typeof e?("string"!=typeof e.name&&t.push("Linter.name must be a string"),("string"!=typeof e.scope||"file"!==e.scope&&"project"!==e.scope)&&t.push("Linter.scope must be either 'file' or 'project'"),"boolean"!=typeof e.lintsOnChange&&t.push("Linter.lintsOnChange must be a boolean"),Array.isArray(e.grammarScopes)||t.push("Linter.grammarScopes must be an Array"),"function"!=typeof e.lint&&t.push("Linter.lint must be a function")):t.push("Linter must be an object"),!t.length||(st("Invalid Linter received",`These issues were encountered while registering a Linter named '${e&&e.name?e.name:"Unknown"}'`,t),!1)})(e)&&(e[at]=!0,void 0===e.__$sb_linter_request_latest&&(e.__$sb_linter_request_latest=0),void 0===e[dt]&&(e[dt]=0),e.__$sb_linter_version=2,this.linters.add(e))}getProviders(){return Array.from(this.linters)}deleteLinter(e){this.linters.has(e)&&(e[at]=!1,this.linters.delete(e))}async lint({onChange:e,editor:t}){const i=t.getPath();if(e&&!this.lintOnChange||!this.lintPreviewTabs&&atom.workspace.getActivePane().getPendingItem()===t||await ut(t.getPath(),this.ignoreGlob,this.ignoreVCS))return!1;const s=ct(t),r=[];for(const n of this.linters){if(!lt(n,e,s))continue;if(this.disabledProviders.includes(n.name))continue;const o=++n.__$sb_linter_request_latest,a="file"===n.scope?t.getBuffer():null,d="file"===n.scope?i:null;this.emitter.emit("did-begin-linting",{number:o,linter:n,filePath:d}),r.push(new Promise((function(e){e(n.lint(t))})).then((e=>{if(this.emitter.emit("did-finish-linting",{number:o,linter:n,filePath:d}),n[dt]>=o||!n[at]||a&&!a.isAlive())return;if(n[dt]=o,a&&!a.isAlive())return;if(null==e)return;let t=!0;!atom.inDevMode()&&Array.isArray(e)||(t=nt(n.name,e)),t&&(pt(n.name,e),this.emitter.emit("did-update-messages",{messages:e,linter:n,buffer:a}))}),(e=>{this.emitter.emit("did-finish-linting",{number:o,linter:n,filePath:d}),console.error(`[Linter] Error running ${n.name}`,e);const t=`[Linter] Error running ${n.name}`;if(Array.from(this.activeNotifications).some((e=>e.getOptions().detail===t)))return;const i=atom.notifications.addError(t,{detail:"See Console for more info.",dismissable:!0,buttons:[{text:"Open Console",onDidClick:()=>{atom.openDevTools(),i.dismiss()}},{text:"Cancel",onDidClick:()=>{i.dismiss()}}]})})))}return await Promise.all(r),!0}onDidUpdateMessages(e){return this.emitter.on("did-update-messages",e)}onDidBeginLinting(e){return this.emitter.on("did-begin-linting",e)}onDidFinishLinting(e){return this.emitter.on("did-finish-linting",e)}dispose(){this.activeNotifications.forEach((e=>e.dismiss())),this.activeNotifications.clear(),this.linters.clear(),this.subscriptions.dispose()}}class zt{constructor(t){if(this.emitter=new e.Emitter,this.subscriptions=new e.CompositeDisposable,!atom.workspace.isTextEditor(t))throw new Error("EditorLinter expects a valid TextEditor");const i=t.getBuffer(),s=Rt((()=>{this.emitter.emit("should-lint",!1)}),50,{leading:!0});this.editor=t,this.subscriptions.add(this.editor.onDidDestroy((()=>this.dispose())),this.editor.onDidSave(s),i.onDidReload(s),this.subscriptiveObserve(atom.config,"linter.lintOnChangeInterval",(e=>i.onDidChange(Rt((()=>{this.emitter.emit("should-lint",!0)}),e)))))}getEditor(){return this.editor}lint(e=!1){this.emitter.emit("should-lint",e)}onShouldLint(e){return this.emitter.on("should-lint",e)}onDidDestroy(e){return this.emitter.on("did-destroy",e)}dispose(){this.emitter.emit("did-destroy"),this.subscriptions.dispose(),this.emitter.dispose()}subscriptiveObserve(t,i,s){let r=null;const n=t.observe(i,(e=>{r&&r.dispose(),r=s.call(this,e)}));return new e.Disposable((function(){n.dispose(),r&&r.dispose()}))}}class qt{constructor(){this.emitter=new e.Emitter,this.lintOnOpen=!0,this.subscriptions=new e.CompositeDisposable,this.editorLinters=new Map,this.subscriptions.add(this.emitter,atom.config.observe("linter.lintOnOpen",(e=>{this.lintOnOpen=e})))}activate(){this.subscriptions.add(atom.workspace.observeTextEditors((e=>{this.createFromTextEditor(e)})))}get(e){return this.editorLinters.get(e)}createFromTextEditor(e){let t=this.editorLinters.get(e);return t||(t=new zt(e),t.onDidDestroy((()=>{this.editorLinters.delete(e)})),this.editorLinters.set(e,t),this.emitter.emit("observe",t),this.lintOnOpen&&t.lint(),t)}hasSibling(e){const t=e.getEditor().getBuffer();return Array.from(this.editorLinters.keys()).some((e=>e.getBuffer()===t))}observe(e){return this.editorLinters.forEach(e),this.emitter.on("observe",e)}dispose(){for(const e of this.editorLinters.values())e.dispose();this.subscriptions.dispose()}}let Vt,Gt,Kt,Wt;function Yt(e){let t;if(e&&"object"==typeof e&&"string"==typeof e.name)t=e.name;else{if("string"!=typeof e)throw new Error("Unknown object passed to formatItem()");t=e}return`  - ${t}`}function Xt(e,t){return e.name.localeCompare(t.name)}class Ht{constructor(){this.emitter=new e.Emitter,this.subscriptions=new e.CompositeDisposable,this.subscriptions.add(this.emitter,atom.commands.add("atom-workspace",{"linter:enable-linter":()=>this.enableLinter(),"linter:disable-linter":()=>this.disableLinter()}),atom.commands.add("atom-text-editor:not([mini])",{"linter:lint":()=>this.lint(),"linter:debug":()=>this.debug(),"linter:toggle-active-editor":()=>this.toggleActiveEditor()}))}lint(){this.emitter.emit("should-lint")}debug(){this.emitter.emit("should-debug")}enableLinter(){this.emitter.emit("should-toggle-linter","enable")}disableLinter(){this.emitter.emit("should-toggle-linter","disable")}toggleActiveEditor(){this.emitter.emit("should-toggle-active-editor")}onShouldLint(e){return this.emitter.on("should-lint",e)}onShouldDebug(e){return this.emitter.on("should-debug",e)}onShouldToggleActiveEditor(e){return this.emitter.on("should-toggle-active-editor",e)}onShouldToggleLinter(e){return this.emitter.on("should-toggle-linter",e)}dispose(){this.subscriptions.dispose()}}class Jt{constructor(t,i){this.emitter=new e.Emitter,this.subscriptions=new e.CompositeDisposable,this.disabledProviders=[],this.action=t,this.providers=i,this.subscriptions.add(this.emitter,atom.config.observe("linter.disabledProviders",(e=>{this.disabledProviders=e})))}getItems(){return"disable"===this.action?this.providers.filter((e=>!this.disabledProviders.includes(e))):this.disabledProviders}process(e){if("disable"===this.action)this.disabledProviders.push(e),this.emitter.emit("did-disable",e);else{const t=this.disabledProviders.indexOf(e);-1!==t&&this.disabledProviders.splice(t,1)}atom.config.set("linter.disabledProviders",this.disabledProviders)}show(){Gt||(Gt=require("atom-select-list"));const t=new Gt({items:this.getItems(),emptyMessage:"No matches found",elementForItem:e=>{const t=document.createElement("li");return t.textContent=e,t},didConfirmSelection:e=>{try{this.process(e),this.dispose()}catch(e){console.error("[Linter] Unable to process toggle:",e)}},didCancelSelection:()=>{this.dispose()},didConfirmEmptySelection:()=>{this.dispose()}}),i=atom.workspace.addModalPanel({item:t});t.focus(),this.subscriptions.add(new e.Disposable((function(){i.destroy()})))}onDidDispose(e){return this.emitter.on("did-dispose",e)}onDidDisable(e){return this.emitter.on("did-disable",e)}dispose(){this.emitter.emit("did-dispose"),this.subscriptions.dispose()}}class Qt{constructor(){this.commands=new Ht,this.subscriptions=new e.CompositeDisposable,this.idleCallbacks=new Set,this.subscriptions.add(this.commands),this.commands.onShouldLint((()=>{this.registryEditorsInit();const e=atom.workspace.getActiveTextEditor();if(void 0===e)return;const t=this.registryEditors.get(e);t&&t.lint()})),this.commands.onShouldToggleActiveEditor((()=>{const e=atom.workspace.getActiveTextEditor();if(void 0===e)return;this.registryEditorsInit();const t=this.registryEditors.get(e);t?t.dispose():e&&this.registryEditors.createFromTextEditor(e)})),this.commands.onShouldDebug((async()=>{this.registryUIInit(),this.registryIndieInit(),this.registryLintersInit(),await async function(e,t,i){Vt||(Vt=require("../package.json"));const s=atom.workspace.getActiveTextEditor();if(void 0===s)return;const r=ct(s),n=e.slice().sort(Xt),o=t.slice().sort(Xt),a=i.slice().sort(Xt),d=o.map(Yt).join("\n"),l=n.map(Yt).join("\n"),c=n.filter((e=>lt(e,!1,r))).map(Yt).join("\n"),h=r.map(Yt).join("\n"),u=a.map(Yt).join("\n"),g=atom.config.get("linter.ignoreGlob"),p=atom.config.get("core.excludeVcsIgnoredPaths"),f=atom.config.get("linter.disabledProviders").map(Yt).join("\n"),m=await ut(s.getPath(),g,p);atom.notifications.addInfo("Linter Debug Info",{detail:[`Platform: ${process.platform}`,`Atom Version: ${atom.getVersion()}`,`Linter Version: ${Vt.version}`,"Opened file is ignored: "+(m?"Yes":"No"),`Matching Linter Providers: \n${c}`,`Disabled Linter Providers: \n${f}`,`Standard Linter Providers: \n${l}`,`Indie Linter Providers: \n${d}`,`UI Providers: \n${u}`,`Ignore Glob: ${g}`,`VCS Ignored Paths are excluded: ${p}`,`Current File Scopes: \n${h}`].join("\n"),dismissable:!0})}(this.registryLinters.getProviders(),this.registryIndie.getProviders(),this.registryUI.getProviders())})),this.commands.onShouldToggleLinter((e=>{this.registryLintersInit();const t=new Jt(e,it(this.registryLinters.getProviders().map((e=>e.name))));t.onDidDispose((()=>{this.subscriptions.remove(t)})),t.onDidDisable((e=>{const t=this.registryLinters.getProviders().find((t=>t.name===e));t&&(this.registryMessagesInit(),this.registryMessages.deleteByLinter(t))})),t.show(),this.subscriptions.add(t)}));const t=window.requestIdleCallback((()=>{this.idleCallbacks.delete(t),this.subscriptions.add(atom.project.onDidChangePaths((()=>{this.commands.lint()})))}));this.idleCallbacks.add(t);const i=window.requestIdleCallback((()=>{this.idleCallbacks.delete(i),this.registryEditorsInit()}));this.idleCallbacks.add(i)}dispose(){this.idleCallbacks.forEach((e=>window.cancelIdleCallback(e))),this.idleCallbacks.clear(),this.subscriptions.dispose()}registryEditorsInit(){void 0===this.registryEditors&&(this.registryEditors=new qt,this.subscriptions.add(this.registryEditors),this.registryEditors.observe((e=>{e.onShouldLint((t=>{this.registryLintersInit(),this.registryLinters.lint({onChange:t,editor:e.getEditor()})})),e.onDidDestroy((()=>{this.registryMessagesInit(),this.registryEditors.hasSibling(e)||this.registryMessages.deleteByBuffer(e.getEditor().getBuffer())}))})),this.registryEditors.activate())}registryLintersInit(){void 0===this.registryLinters&&(this.registryLinters=new Bt,this.subscriptions.add(this.registryLinters),this.registryLinters.onDidUpdateMessages((({linter:e,messages:t,buffer:i})=>{this.registryMessagesInit(),this.registryMessages.set({linter:e,messages:t,buffer:i})})),this.registryLinters.onDidBeginLinting((({linter:e,filePath:t})=>{this.registryUIInit(),this.registryUI.didBeginLinting(e,t)})),this.registryLinters.onDidFinishLinting((({linter:e,filePath:t})=>{this.registryUIInit(),this.registryUI.didFinishLinting(e,t)})))}registryIndieInit(){void 0===this.registryIndie&&(this.registryIndie=new wt,this.subscriptions.add(this.registryIndie),this.registryIndie.observe((e=>{e.onDidDestroy((()=>{this.registryMessagesInit(),this.registryMessages.deleteByLinter(e)}))})),this.registryIndie.onDidUpdate((({linter:e,messages:t})=>{this.registryMessagesInit(),this.registryMessages.set({linter:e,messages:t,buffer:null})})))}registryMessagesInit(){this.registryMessages||(this.registryMessages=new Ft,this.subscriptions.add(this.registryMessages),this.registryMessages.onDidUpdateMessages((e=>{this.registryUIInit(),this.registryUI.render(e)})))}registryUIInit(){void 0===this.registryUI&&(this.registryUI=new ot,this.subscriptions.add(this.registryUI))}addUI(e){this.registryUIInit(),this.registryUI.add(e),this.registryMessagesInit();const t=this.registryMessages.messages;t.length&&e.render({added:t,messages:t,removed:[]})}deleteUI(e){this.registryUIInit(),this.registryUI.delete(e)}addLinter(e){this.registryLintersInit(),this.registryLinters.addLinter(e)}deleteLinter(e){this.registryLintersInit(),this.registryLinters.deleteLinter(e),this.registryMessagesInit(),this.registryMessages.deleteByLinter(e)}addIndie(e){return this.registryIndieInit(),this.registryIndie.register(e,2)}}exports.activate=function(){Wt=new e.CompositeDisposable,Kt=new Qt,Wt.add(Kt,atom.packages.onDidActivateInitialPackages((function(){atom.inSpecMode()||require("atom-package-deps").install("linter",!0)})))},exports.consumeLinter=function(t){const i=Array.isArray(t)?t:[t];for(const e of i)Kt.addLinter(e);return new e.Disposable((()=>{for(const e of i)Kt.deleteLinter(e)}))},exports.consumeUI=function(t){const i=Array.isArray(t)?t:[t];for(const e of i)Kt.addUI(e);return new e.Disposable((()=>{for(const e of i)Kt.deleteUI(e)}))},exports.deactivate=function(){Wt.dispose()},exports.provideIndie=function(){return e=>Kt.addIndie(e)};
//# sourceMappingURL=index.js.map
