exports.id=477,exports.ids=[477],exports.modules={5183:(e,n,t)=>{t.d(n,{GitCodeLensProvider:()=>GitCodeLensProvider});var i=t(9496),s=t(2540),o=t(5255),a=t(6503),r=t(9529),l=t(5148),c=t(9796),m=t(3105),d=t(4336),u=t(4627),g=t(2509);class GitRecentChangeCodeLens extends i.CodeLens{constructor(e,n,t,i,s,o,a,r,l,c){super(r,c),this.languageId=e,this.symbol=n,this.uri=t,this.dateFormat=i,this.blame=s,this.blameRange=o,this.isFullRange=a,this.desiredCommand=l}getBlame(){return this.blame?.()}}class GitAuthorsCodeLens extends i.CodeLens{constructor(e,n,t,i,s,o,a,r){super(a),this.languageId=e,this.symbol=n,this.uri=t,this.blame=i,this.blameRange=s,this.isFullRange=o,this.desiredCommand=r}getBlame(){return this.blame()}}class GitCodeLensProvider{constructor(e){this.container=e}static selector=[{scheme:o.sN.File},{scheme:o.sN.Git},{scheme:o.sN.GitLens},{scheme:o.sN.PRs},{scheme:o.sN.Vsls},{scheme:o.sN.VslsScc},{scheme:o.sN.Virtual},{scheme:o.sN.GitHub}];_onDidChangeCodeLenses=new i.EventEmitter;get onDidChangeCodeLenses(){return this._onDidChangeCodeLenses.event}reset(e){this._onDidChangeCodeLenses.fire()}async provideCodeLenses(e,n){if(e.isDirty&&(0,g.pt)(e.uri))return[];const t=await this.container.tracker.getOrAdd(e);if(!t.isBlameable)return[];let o=!1;if(e.isDirty)if(t.isDirtyIdle){const n=l.D.get("advanced.blame.sizeThresholdAfterEdit");n>0&&e.lineCount>n&&(o=!0)}else o=!0;const a=l.D.get("codeLens",e);let m=a.scopesByLanguage?.find((n=>n.language?.toLowerCase()===e.languageId));null==m&&(m={language:e.languageId}),null==m.scopes&&(m.scopes=a.scopes),null==m.symbolScopes&&(m.symbolScopes=a.symbolScopes),m.symbolScopes=null!=m.symbolScopes?m.symbolScopes=m.symbolScopes.map((e=>e.toLowerCase())):[];const u=[],h=t.uri;let y,C;if(o){if(1!==m.scopes.length||!m.scopes.includes(s.Uy.Document)){let n;if([n,C]=await Promise.all([this.container.git.isTracked(h),(0,r.dO)("vscode.executeDocumentSymbolProvider",e.uri)]),!n)return u}}else{if(n.isCancellationRequested)return u;if(1===m.scopes.length&&m.scopes.includes(s.Uy.Document)?y=await this.container.git.getBlame(h,e):[y,C]=await Promise.all([this.container.git.getBlame(h,e),(0,r.dO)("vscode.executeDocumentSymbolProvider",e.uri)]),null==y||0===y?.lines.length)return u}if(n.isCancellationRequested)return u;const b=(0,c.IH)((()=>e.validateRange(new i.Range(0,0,1e6,1e6)))),S=o?{command:void 0,title:this.getDirtyTitle(a)}:void 0;if(void 0!==C){d.Yd.log("GitCodeLensProvider.provideCodeLenses:",`${C.length} symbol(s) found`);for(const n of C)this.provideCodeLens(u,e,n,m,b,y,h,a,o,S)}if((m.scopes.includes(s.Uy.Document)||m.symbolScopes.includes("file"))&&!m.symbolScopes.includes("!file")&&null==u.find((e=>0===e.range.start.line&&0===e.range.end.line))){const n=b();let t;if(o||a.recentChange.enabled){o||(t=(0,c.IH)((()=>this.container.git.getBlameRange(y,h,n))));const s=new i.SymbolInformation(h.fileName,i.SymbolKind.File,"",new i.Location(h.documentUri(),new i.Range(0,0,0,n.start.character)));u.push(new GitRecentChangeCodeLens(e.languageId,s,h,a.dateFormat,t,n,!0,D(s),a.recentChange.command,S))}if(!o&&a.authors.enabled){void 0===t&&(t=(0,c.IH)((()=>this.container.git.getBlameRange(y,h,n))));const s=new i.SymbolInformation(h.fileName,i.SymbolKind.File,"",new i.Location(h.documentUri(),new i.Range(0,1,0,n.start.character)));u.push(new GitAuthorsCodeLens(e.languageId,s,h,t,n,!0,D(s),a.authors.command))}}return u}getValidateSymbolRange(e,n,t,o){let a,r=!1;const l=i.SymbolKind[e.kind].toLowerCase();switch(e.kind){case i.SymbolKind.File:(n.scopes.includes(s.Uy.Containers)||n.symbolScopes.includes(l))&&(r=!n.symbolScopes.includes(`!${l}`)),r&&(a=t());break;case i.SymbolKind.Package:(n.scopes.includes(s.Uy.Containers)||n.symbolScopes.includes(l))&&(r=!n.symbolScopes.includes(`!${l}`)),r&&(a=D(e),0===a.start.line&&0===a.end.line&&(a=t()));break;case i.SymbolKind.Class:case i.SymbolKind.Interface:case i.SymbolKind.Module:case i.SymbolKind.Namespace:case i.SymbolKind.Struct:(n.scopes.includes(s.Uy.Containers)||n.symbolScopes.includes(l))&&(a=D(e),r=!n.symbolScopes.includes(`!${l}`)&&(o||!a.isSingleLine));break;case i.SymbolKind.Constructor:case i.SymbolKind.Enum:case i.SymbolKind.Function:case i.SymbolKind.Method:case i.SymbolKind.Property:(n.scopes.includes(s.Uy.Blocks)||n.symbolScopes.includes(l))&&(a=D(e),r=!n.symbolScopes.includes(`!${l}`)&&(o||!a.isSingleLine));break;case i.SymbolKind.String:(n.symbolScopes.includes(l)||"markdown"===n.language&&n.scopes.includes(s.Uy.Containers))&&(a=D(e),r=!n.symbolScopes.includes(`!${l}`)&&(o||!a.isSingleLine));break;default:n.symbolScopes.includes(l)&&(a=D(e),r=!n.symbolScopes.includes(`!${l}`)&&(o||!a.isSingleLine))}return r?a??D(e):void 0}provideCodeLens(e,n,t,s,o,a,r,l,m,d){try{const u=this.getValidateSymbolRange(t,s,o,l.includeSingleLineSymbols);if(void 0===u)return;const g=n.lineAt(D(t).start);if(e.length&&e[e.length-1].range.start.line===g.lineNumber)return;let h,y=0;if((m||l.recentChange.enabled)&&(m||(h=(0,c.IH)((()=>this.container.git.getBlameRange(a,r,u)))),e.push(new GitRecentChangeCodeLens(n.languageId,t,r,l.dateFormat,h,u,!1,g.range.with(new i.Position(g.range.start.line,y)),l.recentChange.command,d)),y++),l.authors.enabled){let s=!u.isSingleLine;if(!s&&"csharp"===n.languageId)switch(t.kind){case i.SymbolKind.File:break;case i.SymbolKind.Package:case i.SymbolKind.Module:case i.SymbolKind.Namespace:case i.SymbolKind.Class:case i.SymbolKind.Interface:case i.SymbolKind.Constructor:case i.SymbolKind.Method:case i.SymbolKind.Function:case i.SymbolKind.Enum:s=!0}s&&!m&&(void 0===h&&(h=(0,c.IH)((()=>this.container.git.getBlameRange(a,r,u)))),e.push(new GitAuthorsCodeLens(n.languageId,t,r,h,u,!1,g.range.with(new i.Position(g.range.start.line,y)),l.authors.command)))}}finally{if(k(t))for(const i of t.children)this.provideCodeLens(e,n,i,s,o,a,r,l,m,d)}}resolveCodeLens(e,n){return e instanceof GitRecentChangeCodeLens?this.resolveGitRecentChangeCodeLens(e,n):e instanceof GitAuthorsCodeLens?this.resolveGitAuthorsCodeLens(e,n):Promise.reject(void 0)}resolveGitRecentChangeCodeLens(e,n){const t=e.getBlame();if(null==t)return R("Unknown, (Blame failed)",e);const o=(0,m.Ps)(t.commits.values());if(null==o)return R("Unknown, (Blame failed)",e);let a=`${o.author.name}, ${null==e.dateFormat?o.formattedDate:o.formatDate(e.dateFormat)}`;if(l.D.get("debug")&&(a+=` [${e.languageId}: ${i.SymbolKind[e.symbol.kind]}(${e.range.start.character}-${e.range.end.character}${e.symbol.containerName?`|${e.symbol.containerName}`:""}), Lines (${e.blameRange.start.line+1}-${e.blameRange.end.line+1}), Commit (${o.shortSha})]`),!1===e.desiredCommand)return R(a,e);switch(e.desiredCommand){case s.N4.CopyRemoteCommitUrl:return y(a,e,o,!0);case s.N4.CopyRemoteFileUrl:return C(a,e,o,!0);case s.N4.DiffWithPrevious:return h(a,e,o);case s.N4.OpenCommitOnRemote:return y(a,e,o);case s.N4.OpenFileOnRemote:return C(a,e,o);case s.N4.RevealCommitInView:return b(a,e,o);case s.N4.ShowCommitsInView:return S(a,e,t,o);case s.N4.ShowQuickCommitDetails:return p(a,e,o);case s.N4.ShowQuickCommitFileDetails:return f(a,e,o);case s.N4.ShowQuickCurrentBranchHistory:return N(a,e);case s.N4.ShowQuickFileHistory:return v(a,e);case s.N4.ToggleFileBlame:return w(a,e);case s.N4.ToggleFileChanges:return L(a,e,o);case s.N4.ToggleFileChangesOnly:return L(a,e,o,!0);case s.N4.ToggleFileHeatmap:return F(a,e);default:return e}}resolveGitAuthorsCodeLens(e,n){const t=e.getBlame();if(null==t)return R("? authors (Blame failed)",e);const o=t.authors.size,a=(0,m.Ps)(t.authors.values())?.name??"Unknown";let r=`${(0,u._6)("author",o,{zero:"?"})} (${a}${o>1?" and others":""})`;if(l.D.get("debug")&&(r+=` [${e.languageId}: ${i.SymbolKind[e.symbol.kind]}(${e.range.start.character}-${e.range.end.character}${e.symbol.containerName?`|${e.symbol.containerName}`:""}), Lines (${e.blameRange.start.line+1}-${e.blameRange.end.line+1}), Authors (${(0,m.v_)((0,m.UI)(t.authors.values(),(e=>e.name)),", ")})]`),!1===e.desiredCommand)return R(r,e);const c=(0,m.sE)(t.commits.values(),(e=>e.author.name===a))??(0,m.Ps)(t.commits.values());if(null==c)return R(r,e);switch(e.desiredCommand){case s.N4.CopyRemoteCommitUrl:return y(r,e,c,!0);case s.N4.CopyRemoteFileUrl:return C(r,e,c,!0);case s.N4.DiffWithPrevious:return h(r,e,c);case s.N4.OpenCommitOnRemote:return y(r,e,c);case s.N4.OpenFileOnRemote:return C(r,e,c);case s.N4.RevealCommitInView:return b(r,e,c);case s.N4.ShowCommitsInView:return S(r,e,t);case s.N4.ShowQuickCommitDetails:return p(r,e,c);case s.N4.ShowQuickCommitFileDetails:return f(r,e,c);case s.N4.ShowQuickCurrentBranchHistory:return N(r,e);case s.N4.ShowQuickFileHistory:return v(r,e);case s.N4.ToggleFileBlame:return w(r,e);case s.N4.ToggleFileChanges:return L(r,e,c);case s.N4.ToggleFileChangesOnly:return L(r,e,c,!0);case s.N4.ToggleFileHeatmap:return F(r,e);default:return e}}getDirtyTitle(e){return e.recentChange.enabled&&e.authors.enabled?l.D.get("strings.codeLens.unsavedChanges.recentChangeAndAuthors"):e.recentChange.enabled?l.D.get("strings.codeLens.unsavedChanges.recentChangeOnly"):l.D.get("strings.codeLens.unsavedChanges.authorsOnly")}}function h(e,n,t){return n.command=(0,r._N)({title:e,command:o.Gh.DiffWithPrevious,arguments:[void 0,{commit:t,uri:n.uri.toFileUri()}]}),n}function y(e,n,t,i=!1){return n.command=(0,r._N)({title:e,command:o.Gh.OpenOnRemote,arguments:[{resource:{type:a.J.Commit,sha:t.sha},repoPath:t.repoPath,clipboard:i}]}),n}function C(e,n,t,i=!1){return n.command=(0,r._N)({title:e,command:o.Gh.OpenOnRemote,arguments:[{resource:{type:a.J.Revision,fileName:t.file?.path??"",sha:t.sha},repoPath:t.repoPath,clipboard:i}]}),n}function b(e,n,t){return n.command=(0,r._N)({title:e,command:t?.isUncommitted?"":s.N4.RevealCommitInView,arguments:[n.uri.toFileUri(),{commit:t,sha:void 0===t?void 0:t.sha}]}),n}function S(e,n,t,i){let s;return s=void 0===i?[...(0,m.DZ)(t.commits.values(),(e=>e.isUncommitted?void 0:e.ref))]:[i.ref],n.command=(0,r._N)({title:e,command:0===s.length?"":o.Gh.ShowCommitsInView,arguments:[{repoPath:t.repoPath,refs:s}]}),n}function p(e,n,t){return n.command=(0,r._N)({title:e,command:t?.isUncommitted?"":s.N4.ShowQuickCommitDetails,arguments:[n.uri.toFileUri(),{commit:t,sha:void 0===t?void 0:t.sha}]}),n}function f(e,n,t){return n.command=(0,r._N)({title:e,command:t?.isUncommitted?"":s.N4.ShowQuickCommitFileDetails,arguments:[n.uri.toFileUri(),{commit:t,sha:void 0===t?void 0:t.sha}]}),n}function N(e,n){return n.command=(0,r._N)({title:e,command:s.N4.ShowQuickCurrentBranchHistory,arguments:[n.uri.toFileUri()]}),n}function v(e,n){return n.command=(0,r._N)({title:e,command:s.N4.ShowQuickFileHistory,arguments:[n.uri.toFileUri(),{range:n.isFullRange?void 0:n.blameRange}]}),n}function w(e,n){return n.command=(0,r._N)({title:e,command:o.Gh.ToggleFileBlame,arguments:[n.uri.toFileUri()]}),n}function L(e,n,t,i){return n.command=(0,r._N)({title:e,command:o.Gh.ToggleFileChanges,arguments:[n.uri.toFileUri(),{type:s.VP.Changes,context:{sha:t.sha,only:i,selection:!1}}]}),n}function F(e,n){return n.command=(0,r._N)({title:e,command:o.Gh.ToggleFileHeatmap,arguments:[n.uri.toFileUri()]}),n}function R(e,n){return n.command={title:e,command:""},n}function D(e){return k(e)?e.range:e.location.range}function k(e){return(0,c.is)(e,"children")}}};