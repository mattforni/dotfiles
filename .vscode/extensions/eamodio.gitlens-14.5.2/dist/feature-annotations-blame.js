exports.id=519,exports.ids=[519],exports.modules={8178:(e,t,r)=>{r.d(t,{d:()=>BlameAnnotationProviderBase});var o=r(9496),n=r(7462),a=r(1062),i=r(5148),s=r(4241),l=r(2022),c=r(248),u=Object.defineProperty,h=Object.getOwnPropertyDescriptor;class BlameAnnotationProviderBase extends l.H{constructor(e,t,r,o){super(e,t,r),this.container=o,this.blame=this.container.git.getBlame(this.trackedDocument.uri,t.document),t.document.isDirty&&r.setForceDirtyStateChangeOnNextDocumentChange()}blame;hoverProviderDisposable;clear(){null!=this.hoverProviderDisposable&&(this.hoverProviderDisposable.dispose(),this.hoverProviderDisposable=void 0),super.clear()}async validate(){const e=await this.blame;return null!=e&&0!==e.lines.length}async getBlame(){const e=await this.blame;if(null!=e&&0!==e.lines.length)return e}getComputedHeatmap(e){const t=[];let r,o;for(const n of e.lines)o!==n.sha&&(o=n.sha,r=e.commits.get(n.sha),null!=r&&t.push(r.date));t.sort(((e,t)=>e.getTime()-t.getTime()));const n=new Date;n.setDate(n.getDate()-(i.D.get("heatmap.ageThreshold")||90));const a=n.getTime(),s=[],l=[];for(const e of t)e.getTime()<a?l.push(e):s.push(e);let u;u=s.length&&l.length?{hot:p(s),cold:p(l)}:p(t);const h=(e,t)=>Array.isArray(u)?u:t?u.hot.concat(u.cold):e.getTime()<a?u.cold:u.hot,d=(e,t)=>{const r=e.getTime();let o=0;for(let e=0;e<t.length&&(o=e,!(r>=t[e]));e++);return o};return{coldThresholdTimestamp:a,colors:(0,c.HM)(),computeRelativeAge:e=>d(e,h(e)),computeOpacity:e=>{const t=h(e,!0),r=d(e,t);return Math.max(.2,Math.round(100*(1-r/t.length))/100)}}}registerHoverProviders(e){const t=i.D.get("hovers");t.enabled&&t.annotations.enabled&&(e.details||e.changes)&&(this.hoverProviderDisposable=o.languages.registerHoverProvider({pattern:this.document.uri.fsPath},{provideHover:(t,r,o)=>this.provideHover(e,t,r,o)}))}async provideHover(e,t,r,s){if("line"!==i.D.get("hovers.annotations.over")&&0!==r.character)return;if(this.document.uri.toString()!==t.uri.toString())return;const l=await this.getBlame();if(null==l)return;const c=l.lines[r.line],u=l.commits.get(c.sha);if(null==u)return;const h=(await Promise.all([e.details?this.getDetailsHoverMessage(u,t):void 0,e.changes?(0,a.jw)(this.container,u,await n.YY.fromUri(t.uri),r.line,t):void 0])).filter((e=>Boolean(e)));return new o.Hover(h,t.validateRange(new o.Range(r.line,0,r.line,1073741824)))}async getDetailsHoverMessage(e,t){let r=this.editor.selection.active.line;const o=r+1;r=(e.lines.find((e=>e.line===o))??e.lines[0]).originalLine-1;const s=i.D.get("hovers");return(0,a.nN)(this.container,e,await n.YY.fromUri(t.uri),r,{autolinks:s.autolinks.enabled,dateFormat:i.D.get("defaultDateFormat"),format:s.detailsMarkdownFormat,pullRequests:s.pullRequests.enabled,timeout:250})}}function p(e){const t=[],r=Math.floor(e.length/2),o=e.length%2?e[r].getTime():(e[r-1].getTime()+e[r].getTime())/2;let n=(e[e.length-1].getTime()-o)/5;for(let e=5;e>0;e--)t.push(o+n*e);t.push(o);n=(o-e[0].getTime())/4;for(let e=1;e<=4;e++)t.push(o-n*e);return t}((e,t,r,o)=>{for(var n,a=o>1?void 0:o?h(t,r):t,i=e.length-1;i>=0;i--)(n=e[i])&&(a=(o?n(t,r,a):n(a))||a);o&&a&&u(t,r,a)})([(0,s.cM)({args:!1})],BlameAnnotationProviderBase.prototype,"getComputedHeatmap",1)},4455:(e,t,r)=>{r.d(t,{GutterBlameAnnotationProvider:()=>GutterBlameAnnotationProvider});var o=r(9496),n=r(5255),a=r(9338),i=r(2800),s=r(5148),l=r(4241),c=r(3105),u=r(6004),h=r(6398),p=r(4627),d=r(248),g=r(8178),m=r(623),f=Object.defineProperty,v=Object.getOwnPropertyDescriptor,b=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),y=(e,t,r,o)=>{for(var n,a=o>1?void 0:o?v(t,r):t,i=e.length-1;i>=0;i--)(n=e[i])&&(a=(o?n(t,r,a):n(a))||a);return o&&a&&f(t,r,a),a};class GutterBlameAnnotationProvider extends g.d{constructor(e,t,r){super("blame",e,t,r)}clear(){if(super.clear(),null!=m.I.gutterBlameHighlight)try{this.editor.setDecorations(m.I.gutterBlameHighlight,[])}catch{}}async onProvideAnnotation(e,t){var r,i,l,c,g,f,v=[];try{const t=(0,u.UH)();this.annotationContext=e;const r=await this.getBlame();if(null==r)return!1;const i=((e,t,r)=>{if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw TypeError("Object expected");var o;if(r&&(o=t[b("asyncDispose")]),void 0===o&&(o=t[b("dispose")]),"function"!=typeof o)throw TypeError("Object not disposable");e.push([r,o,t])}else r&&e.push([r]);return t})(v,(0,h.k)(t)),l=s.D.get("blame"),c=(0,p.Gg)(l.format).reduce(((e,t)=>(e[t.key]=t.options,e)),Object.create(null));let g;a.i.has(l.format,"tips")&&(g=await this.container.git.getBranchesAndTagsTipsFn(r.repoPath));const f={dateFormat:null===l.dateFormat?s.D.get("defaultDateFormat"):l.dateFormat,getBranchAndTagTips:g,tokenOptions:c},y=l.avatars,D=s.D.get("defaultGravatarsStyle"),w=l.separateLines,P=(0,d.Vz)(w,l.heatmap,l.avatars,l.format,f),x=[],B=new Map,T=y?new Map:void 0;let A,H,O,S,M=!1;l.heatmap.enabled&&(S=this.getComputedHeatmap(r));for(const e of r.lines){const t=e.line-1;if(O!==e.sha)M=!1,O=e.sha,A=r.commits.get(e.sha),null!=A&&(H=B.get(e.sha),null==H?(H=(0,d.U5)(A,l.format,f,P),null!=S&&(0,d.iF)(H,A.date,S),H.range=new o.Range(t,0,t,0),x.push(H),y&&null!=A.author.email&&await this.applyAvatarDecoration(A,H,D,T),B.set(e.sha,H)):(H={...H,range:new o.Range(t,0,t,0)},x.push(H)));else{if(null==H)continue;H={...H},l.compact&&!M&&(H.renderOptions={before:{...H.renderOptions.before,contentText:n.NE.Space.repeat((0,p.dz)(H.renderOptions.before.contentText))}},w&&(H.renderOptions.before.textDecoration="none;box-sizing: border-box"+(y?";padding: 0 0 0 18px":"")),M=!0),H.range=new o.Range(t,0,t,0),x.push(H)}}return i?.restart({suffix:" to compute gutter blame annotations"}),x.length&&(this.setDecorations([{decorationType:m.I.gutterBlameAnnotation,rangesOrOptions:x}]),i?.stop({suffix:" to apply all gutter blame annotations"})),this.registerHoverProviders(s.D.get("hovers.annotations")),!0}catch(e){var y=e,D=!0}finally{r=v,i=y,l=D,c="function"==typeof SuppressedError?SuppressedError:function(e,t,r,o){return(o=Error(r)).name="SuppressedError",o.error=e,o.suppressed=t,o},g=e=>i=l?new c(e,i,"An error was suppressed during disposal"):(l=!0,e),(f=e=>{for(;e=r.pop();)try{var t=e[1]&&e[1].call(e[2]);if(e[0])return Promise.resolve(t).then(f,(e=>(g(e),f())))}catch(e){g(e)}if(l)throw i})()}}async selection(e,t){if(!1===e||null==m.I.gutterBlameHighlight)return;if(null==t&&(t=await this.blame,!t?.lines.length))return;let r;if(null!=e?.sha)r=e.sha;else if(null!=e?.line){if(e.line>=0){const o=t.lines[e.line];r=o?.sha}}else r=(0,c.Ps)(t.commits.values())?.sha;if(!r)return void this.editor.setDecorations(m.I.gutterBlameHighlight,[]);const n=(0,i.DZ)(t.lines,(e=>e.sha===r?this.editor.document.validateRange(new o.Range(e.line-1,0,e.line-1,1073741824)):void 0));this.editor.setDecorations(m.I.gutterBlameHighlight,n)}async applyAvatarDecoration(e,t,r,o){let n=o.get(e.author.email??"");if(null==n){const t=(await e.getAvatarUri({defaultStyle:r,size:16})).toString(!0);n={contentText:"",height:"16px",width:"16px",textDecoration:`none;position:absolute;top:1px;left:5px;background:url(${encodeURI(t)});background-size:16px 16px;margin-left: 0 !important`},o.set(e.author.email??"",n)}t.renderOptions.after=n}}y([(0,l.cM)()],GutterBlameAnnotationProvider.prototype,"onProvideAnnotation",1),y([(0,l.cM)({args:!1})],GutterBlameAnnotationProvider.prototype,"selection",1)}};