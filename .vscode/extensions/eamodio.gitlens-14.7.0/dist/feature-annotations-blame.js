exports.id=519,exports.ids=[519],exports.modules={8178:(e,t,r)=>{r.d(t,{d:()=>BlameAnnotationProviderBase});var o=r(9496),a=r(7462),i=r(1062),n=r(5148),s=r(4241),l=r(2022),u=r(248),h=Object.defineProperty,d=Object.getOwnPropertyDescriptor;let BlameAnnotationProviderBase=class BlameAnnotationProviderBase extends l.H{blame;hoverProviderDisposable;constructor(e,t,r,o){super(e,t,r,o),this.blame=e.git.getBlame(this.trackedDocument.uri,r.document),r.document.isDirty&&o.setForceDirtyStateChangeOnNextDocumentChange()}clear(){null!=this.hoverProviderDisposable&&(this.hoverProviderDisposable.dispose(),this.hoverProviderDisposable=void 0),super.clear()}async validate(){let e=await this.blame;return!!e?.lines.length}async getBlame(e){e&&(this.blame=this.container.git.getBlame(this.trackedDocument.uri,this.editor.document));let t=await this.blame;if(t?.lines.length)return t}getComputedHeatmap(e){let t,r,o;let a=[];for(let o of e.lines)r!==o.sha&&(r=o.sha,null!=(t=e.commits.get(o.sha))&&a.push(t.date));a.sort((e,t)=>e.getTime()-t.getTime());let i=new Date;i.setDate(i.getDate()-(n.D.get("heatmap.ageThreshold")||90));let s=i.getTime(),l=[],h=[];for(let e of a)e.getTime()<s?h.push(e):l.push(e);o=l.length&&h.length?{hot:p(l),cold:p(h)}:p(a);let d=(e,t)=>Array.isArray(o)?o:t?o.hot.concat(o.cold):e.getTime()<s?o.cold:o.hot,g=(e,t)=>{let r=e.getTime(),o=0;for(let e=0;e<t.length&&(o=e,!(r>=t[e]));e++);return o};return{coldThresholdTimestamp:s,colors:(0,u.HM)(),computeRelativeAge:e=>g(e,d(e)),computeOpacity:e=>{let t=d(e,!0);return Math.max(.2,Math.round((1-g(e,t)/t.length)*100)/100)}}}registerHoverProviders(e){let t=n.D.get("hovers");t.enabled&&t.annotations.enabled&&(e.details||e.changes)&&(this.hoverProviderDisposable?.dispose(),this.hoverProviderDisposable=o.languages.registerHoverProvider({pattern:this.editor.document.uri.fsPath},{provideHover:(t,r,o)=>this.provideHover(e,t,r,o)}))}async provideHover(e,t,r,s){if("line"!==n.D.get("hovers.annotations.over")&&0!==r.character||this.editor.document.uri.toString()!==t.uri.toString())return;let l=await this.getBlame();if(null==l)return;let u=l.lines[r.line],h=l.commits.get(u.sha);if(null==h)return;let d=(await Promise.all([e.details?this.getDetailsHoverMessage(h,t):void 0,e.changes?(0,i.jw)(this.container,h,await a.YY.fromUri(t.uri),r.line,t):void 0])).filter(e=>!!e);return new o.Hover(d,t.validateRange(new o.Range(r.line,0,r.line,1073741824)))}async getDetailsHoverMessage(e,t){let r=this.editor.selection.active.line,o=r+1;r=(e.lines.find(e=>e.line===o)??e.lines[0]).originalLine-1;let s=n.D.get("hovers");return(0,i.nN)(this.container,e,await a.YY.fromUri(t.uri),r,{autolinks:s.autolinks.enabled,dateFormat:n.D.get("defaultDateFormat"),format:s.detailsMarkdownFormat,pullRequests:s.pullRequests.enabled,timeout:250})}};function p(e){let t=[],r=Math.floor(e.length/2),o=e.length%2?e[r].getTime():(e[r-1].getTime()+e[r].getTime())/2,a=(e[e.length-1].getTime()-o)/5;for(let e=5;e>0;e--)t.push(o+a*e);t.push(o),a=(o-e[0].getTime())/4;for(let e=1;e<=4;e++)t.push(o-a*e);return t}((e,t,r,o)=>{for(var a,i=o>1?void 0:o?d(t,r):t,n=e.length-1;n>=0;n--)(a=e[n])&&(i=(o?a(t,r,i):a(i))||i);return o&&i&&h(t,r,i)})([(0,s.cM)({args:!1})],BlameAnnotationProviderBase.prototype,"getComputedHeatmap",1)},4455:(e,t,r)=>{r.d(t,{GutterBlameAnnotationProvider:()=>GutterBlameAnnotationProvider});var o=r(9496),a=r(5255),i=r(9338),n=r(2800),s=r(5148),l=r(4241),u=r(3105),h=r(6004),d=r(6398),p=r(4627),g=r(248),c=r(8178),m=r(623),f=Object.defineProperty,v=Object.getOwnPropertyDescriptor,b=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),y=(e,t,r,o)=>{for(var a,i=o>1?void 0:o?v(t,r):t,n=e.length-1;n>=0;n--)(a=e[n])&&(i=(o?a(t,r,i):a(i))||i);return o&&i&&f(t,r,i),i},D=(e,t,r)=>{if(null!=t){var o;if("object"!=typeof t&&"function"!=typeof t)throw TypeError("Object expected");if(r&&(o=t[b("asyncDispose")]),void 0===o&&(o=t[b("dispose")]),"function"!=typeof o)throw TypeError("Object not disposable");e.push([r,o,t])}else r&&e.push([r]);return t},w=(e,t,r)=>{var o="function"==typeof SuppressedError?SuppressedError:function(e,t,r,o){return(o=Error(r)).name="SuppressedError",o.error=e,o.suppressed=t,o},a=e=>t=r?new o(e,t,"An error was suppressed during disposal"):(r=!0,e),i=o=>{for(;o=e.pop();)try{var n=o[1]&&o[1].call(o[2]);if(o[0])return Promise.resolve(n).then(i,e=>(a(e),i()))}catch(e){a(e)}if(r)throw t};return i()};let GutterBlameAnnotationProvider=class GutterBlameAnnotationProvider extends c.d{constructor(e,t,r){super(e,"blame",t,r)}clear(){if(super.clear(),null!=m.I.gutterBlameHighlight)try{this.editor.setDecorations(m.I.gutterBlameHighlight,[])}catch{}}async onProvideAnnotation(e,t){var r=[];try{let e,n,l,u,c;let f=(0,h.UH)(),v=await this.getBlame(t?.recompute);if(null==v)return!1;let b=D(r,(0,d.k)(f)),y=s.D.get("blame"),w=(0,p.Gg)(y.format).reduce((e,t)=>(e[t.key]=t.options,e),Object.create(null));i.i.has(y.format,"tips")&&(e=await this.container.git.getBranchesAndTagsTipsFn(v.repoPath));let P={dateFormat:null===y.dateFormat?s.D.get("defaultDateFormat"):y.dateFormat,getBranchAndTagTips:e,tokenOptions:w},x=y.avatars,B=s.D.get("defaultGravatarsStyle"),H=y.separateLines,T=(0,g.Vz)(H,y.heatmap,y.avatars,y.format,P),A=[],O=new Map,S=x?new Map:void 0,M=!1;for(let e of(y.heatmap.enabled&&(c=this.getComputedHeatmap(v)),v.lines)){let t=e.line-1;if(u===e.sha){if(null==l)continue;l={...l},y.compact&&!M&&(l.renderOptions={before:{...l.renderOptions.before,contentText:a.NE.Space.repeat((0,p.dz)(l.renderOptions.before.contentText))}},H&&(l.renderOptions.before.textDecoration=`none;box-sizing: border-box${x?";padding: 0 0 0 18px":""}`),M=!0),l.range=new o.Range(t,0,t,0),A.push(l);continue}if(M=!1,u=e.sha,n=v.commits.get(e.sha),null!=n){if(l=O.get(e.sha),null!=l){l={...l,range:new o.Range(t,0,t,0)},A.push(l);continue}l=(0,g.U5)(n,y.format,P,T),null!=c&&(0,g.iF)(l,n.date,c),l.range=new o.Range(t,0,t,0),A.push(l),x&&null!=n.author.email&&await this.applyAvatarDecoration(n,l,B,S),O.set(e.sha,l)}}return b?.restart({suffix:" to compute gutter blame annotations"}),A.length&&(this.setDecorations([{decorationType:m.I.gutterBlameAnnotation,rangesOrOptions:A}]),b?.stop({suffix:" to apply all gutter blame annotations"})),this.registerHoverProviders(s.D.get("hovers.annotations")),!0}catch(e){var n=e,l=!0}finally{w(r,n,l)}}async selection(e){let t;if(!1===e||null==m.I.gutterBlameHighlight)return;let r=await this.blame;if(!r?.lines.length)return;if(e?.sha!=null)t=e.sha;else if(e?.line!=null){if(e.line>=0){let o=r.lines[e.line];t=o?.sha}}else t=u.Ps(r.commits.values())?.sha;if(!t){this.editor.setDecorations(m.I.gutterBlameHighlight,[]);return}let a=(0,n.DZ)(r.lines,e=>e.sha===t?this.editor.document.validateRange(new o.Range(e.line-1,0,e.line-1,1073741824)):void 0);this.editor.setDecorations(m.I.gutterBlameHighlight,a)}async applyAvatarDecoration(e,t,r,o){let a=o.get(e.author.email??"");if(null==a){let t=(await e.getAvatarUri({defaultStyle:r,size:16})).toString(!0);a={contentText:"",height:"16px",width:"16px",textDecoration:`none;position:absolute;top:1px;left:5px;background:url(${encodeURI(t)});background-size:16px 16px;margin-left: 0 !important`},o.set(e.author.email??"",a)}t.renderOptions.after=a}};y([(0,l.cM)()],GutterBlameAnnotationProvider.prototype,"onProvideAnnotation",1),y([(0,l.cM)({args:!1})],GutterBlameAnnotationProvider.prototype,"selection",1)}};