exports.id=278,exports.ids=[278],exports.modules={8178:(e,t,r)=>{r.d(t,{d:()=>BlameAnnotationProviderBase});var o=r(9496),i=r(7462),a=r(1062),n=r(5148),s=r(4241),l=r(2022),u=r(248),p=Object.defineProperty,d=Object.getOwnPropertyDescriptor;let BlameAnnotationProviderBase=class BlameAnnotationProviderBase extends l.H{blame;hoverProviderDisposable;constructor(e,t,r,o){super(e,t,r,o),this.blame=e.git.getBlame(this.trackedDocument.uri,r.document),r.document.isDirty&&o.setForceDirtyStateChangeOnNextDocumentChange()}clear(){null!=this.hoverProviderDisposable&&(this.hoverProviderDisposable.dispose(),this.hoverProviderDisposable=void 0),super.clear()}async validate(){let e=await this.blame;return!!e?.lines.length}async getBlame(e){e&&(this.blame=this.container.git.getBlame(this.trackedDocument.uri,this.editor.document));let t=await this.blame;if(t?.lines.length)return t}getComputedHeatmap(e){let t,r,o;let i=[];for(let o of e.lines)r!==o.sha&&(r=o.sha,null!=(t=e.commits.get(o.sha))&&i.push(t.date));i.sort((e,t)=>e.getTime()-t.getTime());let a=new Date;a.setDate(a.getDate()-(n.D.get("heatmap.ageThreshold")||90));let s=a.getTime(),l=[],p=[];for(let e of i)e.getTime()<s?p.push(e):l.push(e);o=l.length&&p.length?{hot:h(l),cold:h(p)}:h(i);let d=(e,t)=>Array.isArray(o)?o:t?o.hot.concat(o.cold):e.getTime()<s?o.cold:o.hot,m=(e,t)=>{let r=e.getTime(),o=0;for(let e=0;e<t.length&&(o=e,!(r>=t[e]));e++);return o};return{coldThresholdTimestamp:s,colors:(0,u.HM)(),computeRelativeAge:e=>m(e,d(e)),computeOpacity:e=>{let t=d(e,!0);return Math.max(.2,Math.round((1-m(e,t)/t.length)*100)/100)}}}registerHoverProviders(e){let t=n.D.get("hovers");t.enabled&&t.annotations.enabled&&(e.details||e.changes)&&(this.hoverProviderDisposable?.dispose(),this.hoverProviderDisposable=o.languages.registerHoverProvider({pattern:this.editor.document.uri.fsPath},{provideHover:(t,r,o)=>this.provideHover(e,t,r,o)}))}async provideHover(e,t,r,s){if("line"!==n.D.get("hovers.annotations.over")&&0!==r.character||this.editor.document.uri.toString()!==t.uri.toString())return;let l=await this.getBlame();if(null==l)return;let u=l.lines[r.line],p=l.commits.get(u.sha);if(null==p)return;let d=(await Promise.all([e.details?this.getDetailsHoverMessage(p,t):void 0,e.changes?(0,a.jw)(this.container,p,await i.YY.fromUri(t.uri),r.line,t):void 0])).filter(e=>!!e);return new o.Hover(d,t.validateRange(new o.Range(r.line,0,r.line,1073741824)))}async getDetailsHoverMessage(e,t){let r=this.editor.selection.active.line,o=r+1;r=(e.lines.find(e=>e.line===o)??e.lines[0]).originalLine-1;let s=n.D.get("hovers");return(0,a.nN)(this.container,e,await i.YY.fromUri(t.uri),r,{autolinks:s.autolinks.enabled,dateFormat:n.D.get("defaultDateFormat"),format:s.detailsMarkdownFormat,pullRequests:s.pullRequests.enabled,timeout:250})}};function h(e){let t=[],r=Math.floor(e.length/2),o=e.length%2?e[r].getTime():(e[r-1].getTime()+e[r].getTime())/2,i=(e[e.length-1].getTime()-o)/5;for(let e=5;e>0;e--)t.push(o+i*e);t.push(o),i=(o-e[0].getTime())/4;for(let e=1;e<=4;e++)t.push(o-i*e);return t}((e,t,r,o)=>{for(var i,a=o>1?void 0:o?d(t,r):t,n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o?i(t,r,a):i(a))||a);return o&&a&&p(t,r,a)})([(0,s.cM)({args:!1})],BlameAnnotationProviderBase.prototype,"getComputedHeatmap",1)},79:(e,t,r)=>{r.d(t,{GutterHeatmapBlameAnnotationProvider:()=>GutterHeatmapBlameAnnotationProvider});var o=r(9496),i=r(4241),a=r(6004),n=r(6398),s=r(248),l=r(8178),u=Object.defineProperty,p=Object.getOwnPropertyDescriptor,d=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),h=(e,t,r)=>{if(null!=t){var o;if("object"!=typeof t&&"function"!=typeof t)throw TypeError("Object expected");if(r&&(o=t[d("asyncDispose")]),void 0===o&&(o=t[d("dispose")]),"function"!=typeof o)throw TypeError("Object not disposable");e.push([r,o,t])}else r&&e.push([r]);return t},m=(e,t,r)=>{var o="function"==typeof SuppressedError?SuppressedError:function(e,t,r,o){return(o=Error(r)).name="SuppressedError",o.error=e,o.suppressed=t,o},i=e=>t=r?new o(e,t,"An error was suppressed during disposal"):(r=!0,e),a=o=>{for(;o=e.pop();)try{var n=o[1]&&o[1].call(o[2]);if(o[0])return Promise.resolve(n).then(a,e=>(i(e),a()))}catch(e){i(e)}if(r)throw t};return a()};let GutterHeatmapBlameAnnotationProvider=class GutterHeatmapBlameAnnotationProvider extends l.d{constructor(e,t,r){super(e,"heatmap",t,r)}async onProvideAnnotation(e,t){var r=[];try{let e;let i=(0,a.UH)(),l=await this.getBlame(t?.recompute);if(null==l)return!1;let u=h(r,(0,n.k)(i)),p=new Map,d=this.getComputedHeatmap(l);for(let t of l.lines){let r=t.line-1;e=l.commits.get(t.sha),null!=e&&(0,s.Lx)(e.date,d,new o.Range(r,0,r,0),p)}return u?.restart({suffix:" to compute heatmap annotations"}),p.size&&(this.setDecorations([...p.values()]),u?.stop({suffix:" to apply all heatmap annotations"})),!0}catch(e){var i=e,l=!0}finally{m(r,i,l)}}};((e,t,r,o)=>{for(var i,a=o>1?void 0:o?p(t,r):t,n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o?i(t,r,a):i(a))||a);return o&&a&&u(t,r,a)})([(0,i.cM)()],GutterHeatmapBlameAnnotationProvider.prototype,"onProvideAnnotation",1)}};