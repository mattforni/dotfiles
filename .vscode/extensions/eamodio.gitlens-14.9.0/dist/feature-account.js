exports.id=644,exports.ids=[644],exports.modules={9542:(i,t,s)=>{s.d(t,{AccountWebviewProvider:()=>AccountWebviewProvider});var e=s(1398),o=s(5176),n=s(7899),a=s(560);let r=new(s(3355)).m9("subscription/didChange");let AccountWebviewProvider=class AccountWebviewProvider{constructor(i,t){this.container=i,this.host=t,this._disposable=e.Disposable.from(this.container.subscription.onDidChange(this.onSubscriptionChanged,this))}_disposable;dispose(){this._disposable.dispose()}onSubscriptionChanged(i){this.notifyDidChangeSubscription(i.current)}registerCommands(){return[(0,n.Lb)(`${this.host.id}.refresh`,async()=>{await this.validateSubscriptionCore(!0),await this.host.refresh(!0)},this)]}includeBootstrap(){return this.getState()}onReloaded(){this.notifyDidChangeSubscription()}onVisibilityChanged(i){if(!i){this._validateSubscriptionDebounced?.cancel();return}queueMicrotask(()=>void this.validateSubscription())}onWindowFocusChanged(i){if(!i||!this.host.visible){this._validateSubscriptionDebounced?.cancel();return}queueMicrotask(()=>void this.validateSubscription())}async getSubscription(i){let t;let s=i??await this.container.subscription.getSubscription(!0);return t=s.account?.email?(0,o.ML)(s.account.email,34).toString():`${this.host.getWebRoot()??""}/media/gitlens-logo.webp`,{subscription:s,avatar:t,organizationsCount:(await this.container.organizations.getOrganizations()??[]).length}}async getState(i){let t=await this.getSubscription(i);return{...this.host.baseWebviewState,webroot:this.host.getWebRoot(),subscription:t.subscription,avatar:t.avatar,organizationsCount:t.organizationsCount}}notifyDidChangeSubscription(i){return e.window.withProgress({location:{viewId:this.host.id}},async()=>{let t=await this.getSubscription(i);return this.host.notify(r,{...t})})}_validateSubscriptionDebounced=void 0;async validateSubscription(){null==this._validateSubscriptionDebounced&&(this._validateSubscriptionDebounced=(0,a.sg)(this.validateSubscriptionCore,1e3)),await this._validateSubscriptionDebounced()}_validating;async validateSubscriptionCore(i){if(null==this._validating||i){this._validating=this.container.subscription.validate({force:i});try{await this._validating}finally{this._validating=void 0}}}}}};