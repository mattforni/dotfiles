exports.id=785,exports.ids=[785],exports.modules={5884:(e,t,r)=>{r.d(t,{z:()=>BlameAnnotationProviderBase});var a=r(1398),i=r(7931),o=r(153),n=r(4832),s=r(6707),l=r(4983),u=r(7253),h=Object.defineProperty,g=Object.getOwnPropertyDescriptor;let p=1073741824-1;let BlameAnnotationProviderBase=class BlameAnnotationProviderBase extends l.w{blame;hoverProviderDisposable;constructor(e,t,r,a){super(e,t,r,a),this.blame=e.git.getBlame(this.trackedDocument.uri,r.document),r.document.isDirty&&a.setForceDirtyStateChangeOnNextDocumentChange()}clear(){null!=this.hoverProviderDisposable&&(this.hoverProviderDisposable.dispose(),this.hoverProviderDisposable=void 0),super.clear()}async validate(){let e=await this.blame;return!!e?.lines.length}async getBlame(e){e&&(this.blame=this.container.git.getBlame(this.trackedDocument.uri,this.editor.document));let t=await this.blame;if(t?.lines.length)return t}getComputedHeatmap(e){let t,r,a;let i=[];for(let a of e.lines)r!==a.sha&&(r=a.sha,null!=(t=e.commits.get(a.sha))&&i.push(t.date));i.sort((e,t)=>e.getTime()-t.getTime());let o=new Date;o.setDate(o.getDate()-(n.H.get("heatmap.ageThreshold")||90));let s=o.getTime(),l=[],h=[];for(let e of i)e.getTime()<s?h.push(e):l.push(e);a=l.length&&h.length?{hot:d(l),cold:d(h)}:d(i);let g=(e,t)=>Array.isArray(a)?a:t?a.hot.concat(a.cold):e.getTime()<s?a.cold:a.hot,p=(e,t)=>{let r=e.getTime(),a=0;for(let e=0;e<t.length&&(a=e,!(r>=t[e]));e++);return a};return{coldThresholdTimestamp:s,colors:(0,u.v7)(),computeRelativeAge:e=>p(e,g(e)),computeOpacity:e=>{let t=g(e,!0);return Math.max(.2,Math.round((1-p(e,t)/t.length)*100)/100)}}}registerHoverProviders(e){let t=n.H.get("hovers");t.enabled&&t.annotations.enabled&&(e.details||e.changes)&&(this.hoverProviderDisposable?.dispose(),this.hoverProviderDisposable=a.languages.registerHoverProvider({pattern:this.editor.document.uri.fsPath},{provideHover:(t,r,a)=>this.provideHover(e,t,r,a)}))}async provideHover(e,t,r,s){if("line"!==n.H.get("hovers.annotations.over")&&0!==r.character||this.editor.document.uri.toString()!==t.uri.toString())return;let l=await this.getBlame();if(null==l)return;let u=l.lines[r.line],h=l.commits.get(u.sha);if(null==h)return;let g=(await Promise.all([e.details?this.getDetailsHoverMessage(h,t):void 0,e.changes?(0,o.PV)(this.container,h,await i.nk.fromUri(t.uri),r.line,t):void 0])).filter(e=>!!e);return new a.Hover(g,t.validateRange(new a.Range(r.line,0,r.line,p)))}async getDetailsHoverMessage(e,t){let r=this.editor.selection.active.line,a=r+1;r=(e.lines.find(e=>e.line===a)??e.lines[0]).originalLine-1;let s=n.H.get("hovers");return(0,o.MX)(this.container,e,await i.nk.fromUri(t.uri),r,{autolinks:s.autolinks.enabled,dateFormat:n.H.get("defaultDateFormat"),format:s.detailsMarkdownFormat,pullRequests:s.pullRequests.enabled,timeout:250})}};function d(e){let t=[],r=Math.floor(e.length/2),a=e.length%2?e[r].getTime():(e[r-1].getTime()+e[r].getTime())/2,i=(e[e.length-1].getTime()-a)/5;for(let e=5;e>0;e--)t.push(a+i*e);t.push(a),i=(a-e[0].getTime())/4;for(let e=1;e<=4;e++)t.push(a-i*e);return t}((e,t,r,a)=>{for(var i,o=g(t,r),n=e.length-1;n>=0;n--)(i=e[n])&&(o=i(t,r,o)||o);return a&&o&&h(t,r,o)})([(0,s.Rm)({args:!1})],BlameAnnotationProviderBase.prototype,"getComputedHeatmap",1)},641:(e,t,r)=>{r.d(t,{GutterBlameAnnotationProvider:()=>GutterBlameAnnotationProvider});var a=r(1398),i=r(3807),o=r(236),n=r(2927),s=r(4832),l=r(6707),u=r(4026),h=r(3446),g=r(937),p=r(3166),d=r(7253),m=r(5884),c=r(5488),f=Object.defineProperty,v=Object.getOwnPropertyDescriptor,b=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),y=(e,t,r,a)=>{for(var i,o=a>1?void 0:a?v(t,r):t,n=e.length-1;n>=0;n--)(i=e[n])&&(o=(a?i(t,r,o):i(o))||o);return a&&o&&f(t,r,o),o},w=(e,t,r)=>{if(null!=t){var a;if("object"!=typeof t&&"function"!=typeof t)throw TypeError("Object expected");if(r&&(a=t[b("asyncDispose")]),void 0===a&&(a=t[b("dispose")]),"function"!=typeof a)throw TypeError("Object not disposable");e.push([r,a,t])}else r&&e.push([r]);return t},D=(e,t,r)=>{var a="function"==typeof SuppressedError?SuppressedError:function(e,t,r,a){return(a=Error(r)).name="SuppressedError",a.error=e,a.suppressed=t,a},i=e=>t=r?new a(e,t,"An error was suppressed during disposal"):(r=!0,e),o=a=>{for(;a=e.pop();)try{var n=a[1]&&a[1].call(a[2]);if(a[0])return Promise.resolve(n).then(o,e=>(i(e),o()))}catch(e){i(e)}if(r)throw t};return o()};let H=1073741824-1;let GutterBlameAnnotationProvider=class GutterBlameAnnotationProvider extends m.z{constructor(e,t,r){super(e,"blame",t,r)}clear(){if(super.clear(),null!=c.I.gutterBlameHighlight)try{this.editor.setDecorations(c.I.gutterBlameHighlight,[])}catch{}}async onProvideAnnotation(e,t){var r=[];try{let e,n,l,u,m,f;let v=(0,h.dQ)(),b=await this.getBlame(t?.recompute);if(null==b)return!1;let y=w(r,(0,g.u)(v)),D=s.H.get("blame"),H=(0,p.Vx)(D.format).reduce((e,t)=>(e[t.key]=t.options,e),Object.create(null));o.c.has(D.format,"tips")&&(e=await this.container.git.getBranchesAndTagsTipsFn(b.repoPath));let x={dateFormat:null===D.dateFormat?s.H.get("defaultDateFormat"):D.dateFormat,getBranchAndTagTips:e,tokenOptions:H},P={family:s.H.get("blame.fontFamily"),size:s.H.get("blame.fontSize"),weight:s.H.get("blame.fontWeight")},B=D.avatars,T=s.H.get("defaultGravatarsStyle"),A=D.separateLines,O=(0,d.kM)(A,D.heatmap,D.avatars,D.format,x,P),R=[],S=new Map,k=B?new Map:void 0,z=!1;for(let e of(D.heatmap.enabled&&(m=this.getComputedHeatmap(b)),b.lines)){let t=e.line-1;if(u===e.sha){if(null==l)continue;l={...l},D.compact&&!z&&(null==f&&(f=i.EO.Space.repeat((0,p.RG)(l.renderOptions.before.contentText))),l.renderOptions={before:{...l.renderOptions.before,contentText:f}},A&&(l.renderOptions.before.textDecoration=`none;box-sizing: border-box${B?";padding: 0 0 0 18px":""}${P.family?`;font-family: ${P.family}`:""}${P.size?`;font-size: ${P.size}px`:""}`),z=!0),l.range=new a.Range(t,0,t,0),R.push(l);continue}if(z=!1,u=e.sha,n=b.commits.get(e.sha),null!=n){if(l=S.get(e.sha),null!=l){l={...l,range:new a.Range(t,0,t,0)},R.push(l);continue}l=(0,d.w)(n,D.format,x,O),null!=m&&(0,d.nx)(l,n.date,m),l.range=new a.Range(t,0,t,0),R.push(l),B&&null!=n.author.email&&await this.applyAvatarDecoration(n,l,T,k),S.set(e.sha,l)}}return y?.restart({suffix:" to compute gutter blame annotations"}),R.length&&(this.setDecorations([{decorationType:c.I.gutterBlameAnnotation,rangesOrOptions:R}]),y?.stop({suffix:" to apply all gutter blame annotations"})),this.registerHoverProviders(s.H.get("hovers.annotations")),!0}catch(e){var n=e,l=!0}finally{D(r,n,l)}}async selection(e){let t;if(!1===e||null==c.I.gutterBlameHighlight)return;let r=await this.blame;if(!r?.lines.length)return;if(e?.sha!=null)t=e.sha;else if(e?.line!=null){if(e.line>=0){let a=r.lines[e.line];t=a?.sha}}else t=u.$1(r.commits.values())?.sha;if(!t){this.editor.setDecorations(c.I.gutterBlameHighlight,[]);return}let i=(0,n.x1)(r.lines,e=>e.sha===t?this.editor.document.validateRange(new a.Range(e.line-1,0,e.line-1,H)):void 0);this.editor.setDecorations(c.I.gutterBlameHighlight,i)}async applyAvatarDecoration(e,t,r,a){let i=a.get(e.author.email??"");if(null==i){let t=(await e.getAvatarUri({defaultStyle:r,size:16})).toString(!0);i={contentText:"",height:"16px",width:"16px",textDecoration:`none;position:absolute;top:1px;left:5px;background:url(${encodeURI(t)});background-size:16px 16px;margin-left: 0 !important`},a.set(e.author.email??"",i)}t.renderOptions.after=i}};y([(0,l.Rm)()],GutterBlameAnnotationProvider.prototype,"onProvideAnnotation",1),y([(0,l.Rm)({args:!1})],GutterBlameAnnotationProvider.prototype,"selection",1)}};