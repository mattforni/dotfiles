"use strict";var X=Object.create;var w=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var ee=Object.getPrototypeOf,te=Object.prototype.hasOwnProperty;var x=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),se=(t,e)=>{for(var n in e)w(t,n,{get:e[n],enumerable:!0})},D=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Q(e))!te.call(t,s)&&s!==n&&w(t,s,{get:()=>e[s],enumerable:!(r=Z(e,s))||r.enumerable});return t};var m=(t,e,n)=>(n=t!=null?X(ee(t)):{},D(e||!t||!t.__esModule?w(n,"default",{value:t,enumerable:!0}):n,t)),re=t=>D(w({},"__esModule",{value:!0}),t);var j=x(I=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0});I.testExplorerExtensionId=void 0;I.testExplorerExtensionId="hbenl.vscode-test-explorer"});var G=x((Pe,b)=>{"use strict";var ne=typeof process<"u"&&process.env.TERM_PROGRAM==="Hyper",oe=typeof process<"u"&&process.platform==="win32",W=typeof process<"u"&&process.platform==="linux",E={ballotDisabled:"\u2612",ballotOff:"\u2610",ballotOn:"\u2611",bullet:"\u2022",bulletWhite:"\u25E6",fullBlock:"\u2588",heart:"\u2764",identicalTo:"\u2261",line:"\u2500",mark:"\u203B",middot:"\xB7",minus:"\uFF0D",multiplication:"\xD7",obelus:"\xF7",pencilDownRight:"\u270E",pencilRight:"\u270F",pencilUpRight:"\u2710",percent:"%",pilcrow2:"\u2761",pilcrow:"\xB6",plusMinus:"\xB1",question:"?",section:"\xA7",starsOff:"\u2606",starsOn:"\u2605",upDownArrow:"\u2195"},q=Object.assign({},E,{check:"\u221A",cross:"\xD7",ellipsisLarge:"...",ellipsis:"...",info:"i",questionSmall:"?",pointer:">",pointerSmall:"\xBB",radioOff:"( )",radioOn:"(*)",warning:"\u203C"}),F=Object.assign({},E,{ballotCross:"\u2718",check:"\u2714",cross:"\u2716",ellipsisLarge:"\u22EF",ellipsis:"\u2026",info:"\u2139",questionFull:"\uFF1F",questionSmall:"\uFE56",pointer:W?"\u25B8":"\u276F",pointerSmall:W?"\u2023":"\u203A",radioOff:"\u25EF",radioOn:"\u25C9",warning:"\u26A0"});b.exports=oe&&!ne?q:F;Reflect.defineProperty(b.exports,"common",{enumerable:!1,value:E});Reflect.defineProperty(b.exports,"windows",{enumerable:!1,value:q});Reflect.defineProperty(b.exports,"other",{enumerable:!1,value:F})});var L=x((Me,N)=>{"use strict";var ie=t=>t!==null&&typeof t=="object"&&!Array.isArray(t),ae=/[\u001b\u009b][[\]#;?()]*(?:(?:(?:[^\W_]*;?[^\W_]*)\u0007)|(?:(?:[0-9]{1,4}(;[0-9]{0,4})*)?[~0-9=<>cf-nqrtyA-PRZ]))/g,le=()=>typeof process<"u"?process.env.FORCE_COLOR!=="0":!1,H=()=>{let t={enabled:le(),visible:!0,styles:{},keys:{}},e=o=>{let i=o.open=`\x1B[${o.codes[0]}m`,a=o.close=`\x1B[${o.codes[1]}m`,l=o.regex=new RegExp(`\\u001b\\[${o.codes[1]}m`,"g");return o.wrap=(c,u)=>{c.includes(a)&&(c=c.replace(l,a+i));let p=i+c+a;return u?p.replace(/\r*\n/g,`${a}$&${i}`):p},o},n=(o,i,a)=>typeof o=="function"?o(i):o.wrap(i,a),r=(o,i)=>{if(o===""||o==null)return"";if(t.enabled===!1)return o;if(t.visible===!1)return"";let a=""+o,l=a.includes(`
`),c=i.length;for(c>0&&i.includes("unstyle")&&(i=[...new Set(["unstyle",...i])].reverse());c-- >0;)a=n(t.styles[i[c]],a,l);return a},s=(o,i,a)=>{t.styles[o]=e({name:o,codes:i}),(t.keys[a]||(t.keys[a]=[])).push(o),Reflect.defineProperty(t,o,{configurable:!0,enumerable:!0,set(c){t.alias(o,c)},get(){let c=u=>r(u,c.stack);return Reflect.setPrototypeOf(c,t),c.stack=this.stack?this.stack.concat(o):[o],c}})};return s("reset",[0,0],"modifier"),s("bold",[1,22],"modifier"),s("dim",[2,22],"modifier"),s("italic",[3,23],"modifier"),s("underline",[4,24],"modifier"),s("inverse",[7,27],"modifier"),s("hidden",[8,28],"modifier"),s("strikethrough",[9,29],"modifier"),s("black",[30,39],"color"),s("red",[31,39],"color"),s("green",[32,39],"color"),s("yellow",[33,39],"color"),s("blue",[34,39],"color"),s("magenta",[35,39],"color"),s("cyan",[36,39],"color"),s("white",[37,39],"color"),s("gray",[90,39],"color"),s("grey",[90,39],"color"),s("bgBlack",[40,49],"bg"),s("bgRed",[41,49],"bg"),s("bgGreen",[42,49],"bg"),s("bgYellow",[43,49],"bg"),s("bgBlue",[44,49],"bg"),s("bgMagenta",[45,49],"bg"),s("bgCyan",[46,49],"bg"),s("bgWhite",[47,49],"bg"),s("blackBright",[90,39],"bright"),s("redBright",[91,39],"bright"),s("greenBright",[92,39],"bright"),s("yellowBright",[93,39],"bright"),s("blueBright",[94,39],"bright"),s("magentaBright",[95,39],"bright"),s("cyanBright",[96,39],"bright"),s("whiteBright",[97,39],"bright"),s("bgBlackBright",[100,49],"bgBright"),s("bgRedBright",[101,49],"bgBright"),s("bgGreenBright",[102,49],"bgBright"),s("bgYellowBright",[103,49],"bgBright"),s("bgBlueBright",[104,49],"bgBright"),s("bgMagentaBright",[105,49],"bgBright"),s("bgCyanBright",[106,49],"bgBright"),s("bgWhiteBright",[107,49],"bgBright"),t.ansiRegex=ae,t.hasColor=t.hasAnsi=o=>(t.ansiRegex.lastIndex=0,typeof o=="string"&&o!==""&&t.ansiRegex.test(o)),t.alias=(o,i)=>{let a=typeof i=="string"?t[i]:i;if(typeof a!="function")throw new TypeError("Expected alias to be the name of an existing color (string) or a function");a.stack||(Reflect.defineProperty(a,"name",{value:o}),t.styles[o]=a,a.stack=[o]),Reflect.defineProperty(t,o,{configurable:!0,enumerable:!0,set(l){t.alias(o,l)},get(){let l=c=>r(c,l.stack);return Reflect.setPrototypeOf(l,t),l.stack=this.stack?this.stack.concat(a.stack):a.stack,l}})},t.theme=o=>{if(!ie(o))throw new TypeError("Expected theme to be an object");for(let i of Object.keys(o))t.alias(i,o[i]);return t},t.alias("unstyle",o=>typeof o=="string"&&o!==""?(t.ansiRegex.lastIndex=0,o.replace(t.ansiRegex,"")):""),t.alias("noop",o=>o),t.none=t.clear=t.noop,t.stripColor=t.unstyle,t.symbols=G(),t.define=s,t};N.exports=H();N.exports.create=H});var K=x(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});var T="<unknown>";function ce(t){var e=t.split(`
`);return e.reduce(function(n,r){var s=pe(r)||ge(r)||ve(r)||we(r)||Te(r);return s&&n.push(s),n},[])}var de=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\/|[a-z]:\\|\\\\).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,ue=/\((\S*)(?::(\d+))(?::(\d+))\)/;function pe(t){var e=de.exec(t);if(!e)return null;var n=e[2]&&e[2].indexOf("native")===0,r=e[2]&&e[2].indexOf("eval")===0,s=ue.exec(e[2]);return r&&s!=null&&(e[2]=s[1],e[3]=s[2],e[4]=s[3]),{file:n?null:e[2],methodName:e[1]||T,arguments:n?[e[2]]:[],lineNumber:e[3]?+e[3]:null,column:e[4]?+e[4]:null}}var fe=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i;function ge(t){var e=fe.exec(t);return e?{file:e[2],methodName:e[1]||T,arguments:[],lineNumber:+e[3],column:e[4]?+e[4]:null}:null}var he=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,me=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i;function ve(t){var e=he.exec(t);if(!e)return null;var n=e[3]&&e[3].indexOf(" > eval")>-1,r=me.exec(e[3]);return n&&r!=null&&(e[3]=r[1],e[4]=r[2],e[5]=null),{file:e[3],methodName:e[1]||T,arguments:e[2]?e[2].split(","):[],lineNumber:e[4]?+e[4]:null,column:e[5]?+e[5]:null}}var be=/^\s*(?:([^@]*)(?:\((.*?)\))?@)?(\S.*?):(\d+)(?::(\d+))?\s*$/i;function Te(t){var e=be.exec(t);return e?{file:e[3],methodName:e[1]||T,arguments:[],lineNumber:+e[4],column:e[5]?+e[5]:null}:null}var ye=/^\s*at (?:((?:\[object object\])?[^\\/]+(?: \[as \S+\])?) )?\(?(.*?):(\d+)(?::(\d+))?\)?\s*$/i;function we(t){var e=ye.exec(t);return e?{file:e[2],methodName:e[1]||T,arguments:[],lineNumber:+e[3],column:e[4]?+e[4]:null}:null}O.parse=ce});var Ee={};se(Ee,{activate:()=>Se});module.exports=re(Ee);var f=m(require("vscode")),P=m(j());var g=m(require("vscode")),$="didAutoGloballyEnable",U="promptedToUseNative2",_=!1,k="testExplorer.useNativeTesting",C=()=>!!g.workspace.getConfiguration().get(k,!1),v=(t=g.ConfigurationTarget.Global,e=!1)=>{g.workspace.getConfiguration().update(k,!0,t),e||g.window.showInformationMessage('Thanks for taking native testing for a spin! If you run into problems, you can turn the new experience off with the "testExplorer.useNativeTesting" setting.')};var R=class{constructor(e){this.context=e}registerTestAdapter(e){this.shouldPrompt()&&(!this.context.globalState.get($)&&!C()&&(this.context.globalState.update($,!0),v(void 0,!0)),e.testStates(n=>{n.type==="started"&&this.promptToUseNativeTesting()}))}unregisterTestAdapter(){}shouldPrompt(){return!_&&!C()&&!this.context.globalState.get(U)}async promptToUseNativeTesting(){if(!this.shouldPrompt())return;let e="Yes",n="Only in this Workspace",r="No";_=!0;let s=await g.window.showInformationMessage("Would you like to try out VS Code's new native UI for testing?",r,e,n);s&&(s===e?v(g.ConfigurationTarget.Global):s===n?v(g.ConfigurationTarget.Workspace):s===r&&this.context.globalState.update(U,!0))}};var J=m(require("vscode"));var h=m(L()),Y=m(K()),d=m(require("vscode")),A=new WeakMap,xe=(t,e)=>{let n=new Set;return t.filter(r=>{let s=e(r);return n.has(s)?!1:(n.add(s),!0)})},Ie="workbench.view.extension.test",Ce=1,Re=()=>{let t=(0,Y.parse)(new Error().stack||"");for(let e of t){if(!e.file)continue;let n=e.file.split(/[\\/]/g),r=n.indexOf("extensions");if(r===-1)continue;let o=n[r+1].replace(/-[\d.]+$/,"");if(!(o.includes("vscode-test-explorer")||o.includes("test-adapter-converter")))return o}return"Test Adapter Converter"},S=class{constructor(e){this.adapter=e;this.controller=d.tests.createTestController(`test-adapter-ctrl-${Ce++}`,Re()),this.controller.refreshHandler=()=>this.adapter.load(),this.disposables.push(this.controller);let n=i=>(a,l)=>{if(a.continuous&&e.retire){let c=[e.retire(u=>{r(i,a,u.tests?.map(p=>this.itemsById.get(p)).filter(p=>!!p),l)}),l.onCancellationRequested(()=>c.forEach(u=>u.dispose()))]}else r(i,a,a.include,l)},r=(i,a,l,c)=>{if(!l){this.run(this.controller.createTestRun(a),l,i,c);return}let u=new Map;for(let p of l){let y=A.get(p).converter,M=u.get(y);M?M.push(p):u.set(y,[p])}for(let[p,y]of u)p.run(this.controller.createTestRun(a),y,i,c)},s=this.controller.createRunProfile("Run",d.TestRunProfileKind.Run,n(!1),!0);s.supportsContinuousRun=!!e.retire;let o=this.controller.createRunProfile("Debug",d.TestRunProfileKind.Debug,n(!0),!0);o.supportsContinuousRun=!!e.retire,this.disposables.push(e.tests(i=>{switch(i.type){case"finished":this.doneDiscovery?.(),this.doneDiscovery=void 0,this.itemsById.clear(),this.syncTopLevel(i);break;case"started":this.doneDiscovery||d.window.withProgress({title:"An adapter is discovering tests",location:{viewId:Ie}},()=>new Promise(a=>{this.doneDiscovery=a,setTimeout(a,3e4)}));break}}),e.testStates(i=>{let a=this.tasksByRunId.get(i.testRunId??"");if(a)switch(i.type){case"test":return this.onTestEvent(a,i);case"suite":return this.onTestSuiteEvent(i);case"finished":return this.tasksByRunId.delete(i.testRunId??""),a.task.end()}})),e.retire&&this.disposables.push(e.retire(i=>{if(i.tests){let a=i.tests.map(l=>this.itemsById.get(l)).filter(l=>!!l);this.controller.invalidateTestResults(a)}else this.controller.invalidateTestResults()}))}controller;doneDiscovery;itemsById=new Map;tasksByRunId=new Map;runningSuiteByRunId=new Map;disposables=[];_error;get error(){return this._error}get controllerId(){return this.controller.id}dispose(){this.disposables.forEach(e=>e.dispose())}async run(e,n,r,s){if(!this.controller)return;n||(n=V(this.controller.items));let o=this.adapter.testStates(i=>{if(i.type!=="started")return;let a=[n];for(;a.length;)for(let l of a.pop())A.get(l)?.isSuite||e.enqueued(l),a.push(V(l.children));this.tasksByRunId.set(i.testRunId??"",{task:e,announcedTests:new Set}),s.onCancellationRequested(()=>this.adapter.cancel()),o.dispose()});r?this.adapter.debug?this.adapter.debug(n.map(i=>i.id)):o.dispose():this.adapter.run(n.map(i=>i.id))}syncTopLevel(e){if(d.commands.executeCommand("setContext","hasTestConverterTests",!0),e.suite)this.controller.label=this.adapter.workspaceFolder?`${this.adapter.workspaceFolder.name} - ${e.suite.label}`:e.suite.label,this.syncItemChildren(this.controller.items,e.suite.children);else if(e.errorMessage){let n=this.controller.createTestItem("error","Test discovery failed");this._error=e.errorMessage+`


`+new Error().stack?.replace("Error:","Stacktrace:"),n.error=new d.MarkdownString(`[View details](command:testExplorerConverter.showError?${encodeURIComponent(JSON.stringify([this.controllerId]))})`),n.error.isTrusted=!0,this.controller.items.replace([n])}}syncItemChildren(e,n,r){e.replace(xe(n,s=>s.id).map(s=>this.createTest(s,r)))}createTest(e,n){let r=this.controller.createTestItem(e.id,e.label,e.file?z(e.file):n);return A.set(r,{isSuite:e.type==="suite",converter:this}),this.itemsById.set(e.id,r),r.description=e.description,e.line!==void 0&&(r.range=new d.Range(e.line,0,e.line+1,0)),e.errored&&(r.error=e.message),"children"in e&&this.syncItemChildren(r.children,e.children),r}onTestSuiteEvent(e){let n=e.testRunId??"",r=this.runningSuiteByRunId.get(n),s=typeof e.suite=="string"?e.suite:e.suite.id;e.state==="running"?(!this.itemsById.has(s)&&typeof e.suite=="object"&&r&&r.children.add(this.createTest(e.suite)),this.itemsById.has(s)&&this.runningSuiteByRunId.set(n,this.itemsById.get(s))):r&&r.id===s&&(r.parent?this.runningSuiteByRunId.set(n,r.parent):this.runningSuiteByRunId.delete(n))}onTestEvent({task:e,announcedTests:n},r){let s=this.runningSuiteByRunId.get(r.testRunId??""),o=typeof r.test=="string"?r.test:r.test.id;r.state==="running"&&!this.itemsById.has(o)&&typeof r.test=="object"&&s&&s.children.add(this.createTest(r.test));let i=this.itemsById.get(o);if(i){switch(r.state){case"skipped":this.appendState(e,i,"\u25CB",h.yellow,h.dim),e.skipped(i);break;case"running":e.started(i);break;case"passed":this.ensureChainAnnounced(e,n,i),this.appendState(e,i,"\u2714",h.green),e.passed(i);break;case"errored":case"failed":this.ensureChainAnnounced(e,n,i),this.appendState(e,i,"\u2716",h.red,h.red);let a=[];if(r.message&&(e.appendOutput(r.message.replace(/\r?\n/g,`\r
`),void 0,i),!r.decorations?.length)){let l=new d.TestMessage(r.message);a.push(l)}for(let l of r.decorations??[]){let c=new d.TestMessage(l.message),u=l.file?z(l.file):i.uri;u&&(c.location=new d.Location(u,new d.Position(l.line,0))),a.push(c)}e[r.state](i,a);break}r.message&&(r.state!=="errored"&&r.state!=="failed"||!i.uri)&&e.appendOutput(r.message.replace(/\r?\n/g,`\r
`))}}ensureChainAnnounced(e,n,r){let s=[];for(let o=r;o&&!n.has(o);o=o.parent)s.unshift(o);for(let o of s)n.add(o),o.children.size&&this.appendState(e,o,"\u25BC",h.green)}appendState(e,n,r,s,o=i=>i){let i="";for(let a=n.parent;a;a=a.parent)i+="  ";e.appendOutput(i+s(r)+o(` ${n.label}\r
`))}},V=t=>{let e=[];return t.forEach(n=>e.push(n)),e},ke=/^[a-z][a-z0-9+-.]+:/,z=t=>ke.test(t)?d.Uri.parse(t):d.Uri.file(t);var B=class{converters=new Map;registerTestAdapter(e){this.converters.set(e,new S(e))}unregisterTestAdapter(e){this.converters.get(e)?.dispose(),this.converters.delete(e)}getByControllerId(e){for(let n of this.converters.values())if(n.controllerId===e)return n}dispose(){for(let e of this.converters.values())e.dispose();J.commands.executeCommand("setContext","hasTestConverterTests",!1)}};function Se(t){let e,n=new R(t);n.shouldPrompt()&&setTimeout(()=>{let r=f.extensions.getExtension(P.testExplorerExtensionId)?.exports;r&&(r.registerTestController(n),t.subscriptions.push({dispose(){r.unregisterTestController(n)}}))},2e3),t.subscriptions.push(f.commands.registerCommand("testExplorerConverter.activate",()=>{let r=f.extensions.getExtension(P.testExplorerExtensionId)?.exports;r&&(e=new B,t.subscriptions.push(e),r.registerTestController(e),t.subscriptions.push({dispose(){r.unregisterTestController(e)}}))}),f.workspace.onDidChangeConfiguration(r=>{r.affectsConfiguration(k)&&(C()||(e?.dispose(),e=void 0))}),f.commands.registerCommand("testExplorerConverter.useNativeTesting",()=>v()),f.commands.registerCommand("testExplorerConverter.showError",r=>{let s=e?.getByControllerId(r)?.error;s&&Be(s)}))}var Be=async t=>{let e=await f.workspace.openTextDocument({content:t});await f.window.showTextDocument(e)};0&&(module.exports={activate});
