!function(){var t={527:function(t,e,n){t.exports=function(t){for(var e=-1,n=t?t.length:0,r=0,o=[];++e<n;){var i=t[e];i&&(o[r++]=i)}return o}},178:function(t,e,n){var r,o="__lodash_hash_undefined__",i=1/0,c=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/,s=/^\./,u=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,l=/\\(\\)?/g,f=/^\[object .+?Constructor\]$/,p="object"==typeof global&&global&&global.Object===Object&&global,d="object"==typeof self&&self&&self.Object===Object&&self,h=p||d||Function("return this")(),m=Array.prototype,y=Function.prototype,g=Object.prototype,v=h["__core-js_shared__"];var _=(r=/[^.]+$/.exec(v&&v.keys&&v.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",b=y.toString,S=g.hasOwnProperty,E=g.toString,O=RegExp("^"+b.call(S).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),T=h.Symbol,w=m.splice,j=A(h,"Map"),x=A(Object,"create"),N=T?T.prototype:void 0,F=N?N.toString:void 0;function R(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function $(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}R.prototype.clear=function(){this.__data__=x?x(null):{}},R.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},R.prototype.get=function(t){var e=this.__data__;if(x){var n=e[t];return n===o?void 0:n}return S.call(e,t)?e[t]:void 0},R.prototype.has=function(t){var e=this.__data__;return x?void 0!==e[t]:S.call(e,t)},R.prototype.set=function(t,e){return this.__data__[t]=x&&void 0===e?o:e,this};function C(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}$.prototype.clear=function(){this.__data__=[]},$.prototype.delete=function(t){var e=this.__data__,n=P(e,t);return!(n<0)&&(n==e.length-1?e.pop():w.call(e,n,1),!0)},$.prototype.get=function(t){var e=this.__data__,n=P(e,t);return n<0?void 0:e[n][1]},$.prototype.has=function(t){return P(this.__data__,t)>-1},$.prototype.set=function(t,e){var n=this.__data__,r=P(n,t);return r<0?n.push([t,e]):n[r][1]=e,this};function P(t,e){for(var n=t.length;n--;)if(function(t,e){return t===e||t!=t&&e!=e}(t[n][0],e))return n;return -1}C.prototype.clear=function(){this.__data__={hash:new R,map:new(j||$),string:new R}},C.prototype.delete=function(t){return I(this,t).delete(t)},C.prototype.get=function(t){return I(this,t).get(t)},C.prototype.has=function(t){return I(this,t).has(t)},C.prototype.set=function(t,e){return I(this,t).set(t,e),this};function I(t,e){var n=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?n["string"==typeof e?"string":"hash"]:n.map}function A(t,e){var n,r,o,i=(n=t,r=e,null==n?void 0:n[r]);return!(!D(o=i)||function(t){return!!_&&_ in t}(o))&&((function(t){var e=D(t)?E.call(t):"";return"[object Function]"==e||"[object GeneratorFunction]"==e})(o)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(o)?O:f).test(function(t){if(null!=t){try{return b.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(o))?i:void 0}var k=L(function(t){t=function(t){return null==t?"":function(t){if("string"==typeof t)return t;if(U(t))return F?F.call(t):"";var e=t+"";return"0"==e&&1/t==-i?"-0":e}(t)}(t);var e=[];return s.test(t)&&e.push(""),t.replace(u,function(t,n,r,o){e.push(r?o.replace(l,"$1"):n||t)}),e});function L(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw TypeError("Expected a function");var n=function(){var r=arguments,o=e?e.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var c=t.apply(this,r);return n.cache=i.set(o,c),c};return n.cache=new(L.Cache||C),n}L.Cache=C;var M=Array.isArray;function D(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function U(t){var e;return"symbol"==typeof t||!!(e=t)&&"object"==typeof e&&"[object Symbol]"==E.call(t)}t.exports=function(t,e,n){var r=null==t?void 0:function(t,e){e=function(t,e){if(M(t))return!1;var n=typeof t;return!!("number"==n||"symbol"==n||"boolean"==n||null==t||U(t))||a.test(t)||!c.test(t)||null!=e&&t in Object(e)}(e,t)?[e]:function(t){return M(t)?t:k(t)}(e);for(var n=0,r=e.length;null!=t&&n<r;)t=t[function(t){if("string"==typeof t||U(t))return t;var e=t+"";return"0"==e&&1/t==-i?"-0":e}(e[n++])];return n&&n==r?t:void 0}(t,e);return void 0===r?n:r}},139:function(t,e,n){t=n.nmd(t);var r,o,i,c="[object Map]",a="[object Promise]",s="[object Set]",u="[object WeakMap]",l="[object DataView]",f=/^\[object .+?Constructor\]$/,p="object"==typeof global&&global&&global.Object===Object&&global,d="object"==typeof self&&self&&self.Object===Object&&self,h=p||d||Function("return this")(),m="object"==typeof e&&e&&!e.nodeType&&e,y=m&&"object"==typeof t&&t&&!t.nodeType&&t,g=y&&y.exports===m,v=Function.prototype,_=Object.prototype,b=h["__core-js_shared__"];var S=(r=/[^.]+$/.exec(b&&b.keys&&b.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",E=v.toString,O=_.hasOwnProperty,T=_.toString,w=RegExp("^"+E.call(O).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),j=g?h.Buffer:void 0,x=_.propertyIsEnumerable;var N=j?j.isBuffer:void 0,F=(o=Object.keys,i=Object,function(t){return o(i(t))}),R=G(h,"DataView"),$=G(h,"Map"),C=G(h,"Promise"),P=G(h,"Set"),I=G(h,"WeakMap"),A=!x.call({valueOf:1},"valueOf"),k=J(R),L=J($),M=J(C),D=J(P),U=J(I);function G(t,e){var n,r,o,i=(n=t,r=e,null==n?void 0:n[r]);return!(!V(o=i)||function(t){return!!S&&S in t}(o))&&(Y(o)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(o)?w:f).test(J(o))?i:void 0}var W=function(t){return T.call(t)};(R&&W(new R(new ArrayBuffer(1)))!=l||$&&W(new $)!=c||C&&W(C.resolve())!=a||P&&W(new P)!=s||I&&W(new I)!=u)&&(W=function(t){var e=T.call(t),n="[object Object]"==e?t.constructor:void 0,r=n?J(n):void 0;if(r)switch(r){case k:return l;case L:return c;case M:return a;case D:return s;case U:return u}return e});function J(t){if(null!=t){try{return E.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var X=Array.isArray;function q(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}(t.length)&&!Y(t)}var B=N||function(){return!1};function Y(t){var e=V(t)?T.call(t):"";return"[object Function]"==e||"[object GeneratorFunction]"==e}function V(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}t.exports=function(t){if(q(t)&&(X(t)||"string"==typeof t||"function"==typeof t.splice||B(t)||function(t){return function(t){return!!t&&"object"==typeof t}(t)&&q(t)}(e=t)&&O.call(e,"callee")&&(!x.call(e,"callee")||"[object Arguments]"==T.call(e))))return!t.length;var e,n,r,o=W(t);if(o==c||o==s)return!t.size;if(A||(r=(n=t)&&n.constructor,n===("function"==typeof r&&r.prototype||_)))return!F(t).length;for(var i in t)if(O.call(t,i))return!1;return!0}},333:function(t,e,n){t.exports=require("vscode")},771:function(t,e,n){t.exports=require("node:path")},948:function(t,e,n){t.exports=require("path")},275:function(t,e,n){"use strict";n.r(e),n.d(e,{EXTENSION_NAME:function(){return r},SETTINGS_RSPEC_COMMAND_KEY:function(){return o},SETTINGS_RSPEC_FOLDER:function(){return i},SETTINGS_RSPEC_CONTROLLER_FOLDER:function(){return c},SETTINGS_SUFFIX_FILE:function(){return a},SETTINGS_INTEGRATION_TYPE:function(){return s},SETTINGS_DEFAULT:function(){return u}});let r="vscode-run-rspec-file",o=`${r}.custom-command`,i=`${r}.folder`,c=`${r}.controller-spec-directory`,a=`${r}.suffix`,s=`${r}.integration`,u={customCommand:"bundle exec rspec",folder:"spec",suffix:"spec",controllerFolder:"controllers",integration:"rails"}},624:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return u}});var r=n("771"),o=n.n(r),i=n("527"),c=n.n(i),a=n("178"),s=n.n(a);class u{filepath;config;constructor(t,e={}){this.filepath=t,this.config={suffix:"spec",folder:"spec",integration:"rails",controllerFolder:"controllers",...e||{}}}static fromRelativeUri(t,e){return new u(t,e).toJSON()}controllerFolderOrDefault(){return s(this.config,"controllerFolder","controllers")}isExpectation=t=>/^(spec|test)/.test(t);isLibrary=t=>/lib/.test(t);isRailsApp=()=>this.config?.integration=="rails";isDevContainer=()=>this.config?.integration=="devcontainer";toJSON(){let t=c(this.filepath.split(o.sep)),e=t[0],n=t.slice(1).join("/"),r=n.match(/(?<ext>\.rb)$/)?.groups?.ext,i=n.match(/(\w+_)(?<suffix>spec|test)\.rb$/)?.groups?.suffix,a=[e,n].join("/");this.isLibrary(e)&&(n=t.join("/"));let s={namespace:e,name:n,suffix:i,ext:r,path:a,inversePath:"",specPath:"",isRailsApp:this.isRailsApp(),isDevContainer:this.isDevContainer()};if(this.isExpectation(i)){let t=n.replace(RegExp(`_${i}`),"");this.isLibrary(a)?s.inversePath=["lib",t].join("/").replace(/^(lib\/)(lib)/,"$2"):(t=t.replace("requests","controllers").replace(/^spec\//,""),s.inversePath=["app",t].join("/"))}else{let t=this.isRailsApp()?n:a;t=this.isDevContainer()?a:n,this.isDevContainer()&&(t=t.replace(/^app\//,""));let e=t.replace("controllers",this.controllerFolderOrDefault()).replace(".rb",`_${this.config?.suffix||"spec"}.rb`);s.inversePath=c([this.config?.folder,e]).join("/")}return s.specPath=this.isExpectation(i)?s.path:s.inversePath,s}}},130:function(t,e,n){"use strict";n.r(e),n.d(e,{isMultipleWorkSpaces:function(){return p},log:function(){return h},getWorkspace:function(){return m},createTerminal:function(){return y},getActiveLine:function(){return v},clearTerminal:function(){return _},factorySettings:function(){return E}});var r=n("333"),o=n("178"),i=n.n(o),c=n("948"),a=n.n(c),s=n("275"),u=n("597");let l={},f={},p=()=>r.workspace.workspaceFolders.length>1,d=r.window.createOutputChannel("vscode-run-rspec-file");function h(...t){return d.appendLine(t.join(" "))}function m(){let t=r.window.activeTextEditor.document.uri.path;h("Utils[getWorkspace] uri",t);let e=new u.default(t),n=e.toJSON();return h("Utils[getWorkspace] project",JSON.stringify(n)),{method:e,path:n.uri,name:n.name}}function y(t,e){let n=a.isAbsolute(e)?e:`/${e}`;return r.window.createTerminal({name:t,cwd:n})}function g(t,e){return e?t[e]:t}function v(){return r.window.activeTextEditor.selection.active.line+1}function _(){return r.window.activeTextEditor.document.save(),r.commands.executeCommand("workbench.action.terminal.clear")}async function b(){let t=m().name;try{if(f[t])return f[t];function e(t,e){let n=e.get(t),r=e.get(`${s.EXTENSION_NAME}.${t}`),o=e.inspect(`${s.EXTENSION_NAME}.${t}`)?.defaultValue;return n||r||o}let n=r.workspace.getConfiguration(s.EXTENSION_NAME),o=e("custom-command",n),i=e("folder",n),c=e("controller-spec-directory",n),a=e("suffix",n),u=e("integration",n),l={...s.SETTINGS_DEFAULT,customCommand:o,folder:i,suffix:a,controllerFolder:c,integration:u};return f[t]=l,l}catch(t){return console.error(t),s.SETTINGS_DEFAULT}}async function S(){try{let t=m(),e=await r.workspace.findFiles("**/.vscode/settings.json"),n=e.find(e=>String(e.path).includes(t.path));if(!n)return null;let o=await r.workspace.fs.readFile(r.Uri.parse(n.fsPath)),i=JSON.parse(o.toString());return i}catch(t){return console.error(t),r.window.showErrorMessage("RSpec Extension: parse settings.json failed"),null}}async function E(t){let e=m().name;if(l[e])return g(l[e],t);let n=await b();try{let r=await S(),o={customCommand:i(r,s.SETTINGS_RSPEC_COMMAND_KEY)||n.customCommand,folder:i(r,s.SETTINGS_RSPEC_FOLDER)||n.folder,controllerFolder:i(r,s.SETTINGS_RSPEC_CONTROLLER_FOLDER)||n.controllerFolder,suffix:i(r,s.SETTINGS_SUFFIX_FILE)||n.suffix,integration:i(r,s.SETTINGS_INTEGRATION_TYPE)||n.integration};return l[e]=o,g(o,t)}catch(e){return console.error(e),g(n,t)}}},597:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return l}});var r=n("771"),o=n.n(r),i=n("527"),c=n.n(i),a=n("139"),s=n.n(a),u=n("624");class l{name;fileUri;uri;constructor(t){this.fileUri=t}toJSON(){let t=c(this.fileUri.split(o.sep)),e=t.findIndex(t=>RegExp("^(app|spec|test|lib)$").test(t)),n=t.slice(0,e);return s(n)&&(n=t.slice(0,1)),this.uri=n.join("/"),this.name=n.slice(-1)[0],{uri:this.uri,name:this.name}}fromFileUri(t){let e=this.fileUri;return e=(e=e.replace(this.uri,"")).replace(/^\/?\/?/,""),u.default.fromRelativeUri(e,t)}}},436:function(t,e,n){"use strict";n.r(e),n.d(e,{activate:function(){return m},deactivate:function(){return y}});var r=n("333"),o=n("178"),i=n.n(o),c=n("624"),a=n("130");let s={},u="";function l(t){let e=function(){let t=(0,a.getWorkspace)(),e=[t.name,"RSpec Run"].join(" - ");if(!(0,a.isMultipleWorkSpaces)()){let n=r.window.terminals.find(t=>t.name==e);return n?n:(0,a.createTerminal)(e,t.path)}return i(s,e)?i(s,e):(s[e]=(0,a.createTerminal)(e,t.path),i(s,e))}();e.sendText(t),e.show(!1),u=t}async function f(){return l((await (0,a.factorySettings)()).customCommand)}async function p(t){let e=await (0,a.factorySettings)(),n=(0,a.getWorkspace)(),r=n.method.fromFileUri(e);(0,a.log)("Extension[bundleRspecFile]",JSON.stringify({workspace:n,file:r}));let o=`${e.customCommand} ${r.specPath}`;return t&&(o=`${o}:${t}`),(0,a.log)(`Running bundleRspec command ${o}`),l(o)}async function d(){let t=r.workspace.textDocuments,e=(0,a.getWorkspace)(),n={},o=[],i=await (0,a.factorySettings)();for(let r of t)if(r.fileName.endsWith(".rb")&&r.fileName.includes(e.path)){let t=r.fileName.replace(e.path,"");t.startsWith("/")&&(t=t.substring(1));let o=c.default.fromRelativeUri(t,i).specPath;n[o]=o}return(o=Object.keys(n).filter(t=>!!t)).length<=0?r.window.showInformationMessage("Not found opened spec files"):l(`${i.customCommand} ${o.join(" ")}`)}async function h(){let t=await (0,a.factorySettings)(),e=(0,a.getWorkspace)(),n=e.method.fromFileUri(t);(0,a.log)("WorkSpace[fromFileUri] file",JSON.stringify(n));let o=[e?.path,n?.inversePath].filter(Boolean).join("/");return r.commands.executeCommand("vscode.open",r.Uri.file(o))}async function m(t){t.subscriptions.push(r.commands.registerCommand("extension.runOpenSpec",h)),t.subscriptions.push(r.commands.registerCommand("extension.runFileOnRspec",()=>{(0,a.clearTerminal)().then(()=>p())})),t.subscriptions.push(r.commands.registerCommand("extension.runAllFilesOnRspec",()=>{(0,a.clearTerminal)().then(()=>f())})),t.subscriptions.push(r.commands.registerCommand("extension.runAllOpenedFiles",()=>{(0,a.clearTerminal)().then(()=>d())})),t.subscriptions.push(r.commands.registerCommand("extension.runLineOnRspec",async()=>{(0,a.clearTerminal)().then(async()=>p((0,a.getActiveLine)()))})),t.subscriptions.push(r.commands.registerCommand("extension.runOnLastSpec",()=>{(0,a.clearTerminal)().then(()=>void(u?l(u):r.window.showWarningMessage("RSpec : Not found last command executed")))}))}function y(){}r.window.onDidCloseTerminal(t=>{s[t.name]&&delete s[t.name]})}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={id:r,loaded:!1,exports:{}};return t[r](i,i.exports,n),i.loaded=!0,i.exports}n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.d=function(t,e){for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){return t&&t.__esModule?t.default:t},n.nmd=function(t){return t.paths=[],!t.children&&(t.children=[]),t};var r=n("436");module.exports=r}();
//# sourceMappingURL=extension.js.map